<div class="container-fluid">
    <!-- start page title -->
    <div class="row">
        <div class="col-12">
            <div class="page-title-box">
                <p class="mb-0 h4">Statistiques</p>
            </div>
        </div>
    </div>
    <!-- end page title -->

    <div class="row mt-4">
        <div class="col-12">
            <form class="card card-body" [formGroup]="form" (ngSubmit)="getStatistics()">
                <div class="row g-2 align-items-center">

                <label class="col-auto">Date : </label>
                <div class="col-auto clockpicker">
                    <input ngbDatepicker [minDate]="{year: 1900, month: 1, day: 1}" formControlName="dateStart" class="form-control" (click)="ds.open()" #ds="ngbDatepicker">
                </div>
                <div class="col-auto clockpicker">
                    <input ngbDatepicker [minDate]="{year: 1900, month: 1, day: 1}" formControlName="dateEnd" class="form-control" (click)="de.open()" #de="ngbDatepicker">
                </div>
                
                <span class="mx-3 my-0 text-muted w-auto">|</span>

                <label class="col-auto">DPS : </label>
                <div class="col-2">
                <ng-select 
                    formControlName="dps"
                    placeholder="DPS"
                    [ngClass]="{'is-invalid':dps.invalid && submitted}">
                    <ng-option *ngFor="let dps of (service.dps$ | async)" [value]="dps['@id']">{{dps.titre}}</ng-option>
                </ng-select>
                </div>
                <span class="mx-3 my-0 text-muted w-auto">|</span>
                
                <label class="col-auto">Equipe : </label>
                <div class="col-2">
                <ng-select 
                    formControlName="team"
                    placeholder="Equipe"
                    [ngClass]="{'is-invalid':team.invalid && submitted}">
                    <ng-option *ngFor="let team of (service.teams$ | async)" [value]="team['@id']">{{team.titre}}</ng-option>
                </ng-select>
                </div>
                
                <span class="mx-3 my-0 text-muted w-auto">|</span>
                <button class="btn btn-success w-auto">Appliquer</button>

                </div>
            </form>
        </div>
    </div>



    <div class="row mt-4">
        <div class="col-4">
            <div class="card card-body">
                <div class="card-title"><i class="fas fa-circle me-1 text-info"></i> Equipe 1</div>

                <table class="table table-centered align-middle table-nowrap">
                <tbody>
                    <tr>
                    <td class="w-50">
                        <p class="mb-0"><a class="text-body text-decoration-underline" [routerLink]="authService.isAuthorized('visites_show') ? '/visites': null">Visite au sol</a></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">1800 km</h5>
                        <!-- each visit has edges - each edge has a length -->
                        <!-- get sum of length of visits of this team (all time ? month) -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0"><a class="text-body text-decoration-underline" [routerLink]="authService.isAuthorized('anomalies_show') ? '/anomalies': null">Anomalies réalisées</a></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">20%</h5>
                        <!-- each team has a visites - each visit has anomalies -->
                        <!-- get total anomalies with status true of this team (all time) -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">
                            <a class="text-body text-decoration-underline" [routerLink]="authService.isAuthorized('anomalies_show') ? '/anomalies': null">Nombre d'incidents
                            <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small>
                            <span role="status" class="spinner-grow text-danger ms-1" style="width: 0.4rem; height: 0.4rem;vertical-align: 0.475em;"></span>
                            </a>
                        </p>
                        <!-- each mission has a depar - each depar has a team -->
                        <!-- get sum of mission type:true of this team of this month -->
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">Nombre de coupures <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                        <!-- each mission has a depar - each depar has a team -->
                        <!-- get sum of mission type:false of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">Nombre de clients coupés <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                        <!-- each mission has a node - each node has a post - each post has clients count -->
                        <!-- get sum of clients count of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">Nombre de postes coupés <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                        <!-- each mission has a node - each node has a post -->
                        <!-- get sum of post  of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">DMS <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">0.45</h5>
                        <!-- each mission has DMS -->
                        <!-- get sum of DMS  of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">IFS <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">0.32</h5>
                        <!-- each mission has IFS -->
                        <!-- get sum of IFS  of this team of this month -->
                    </td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>
        <div class="col-4">
            <div class="card card-body">
                <div class="card-title"><i class="fas fa-circle me-1 text-success"></i> Equipe 1</div>

                <table class="table table-centered align-middle table-nowrap">
                <tbody>
                    <tr>
                    <td class="w-50">
                        <p class="mb-0"><a class="text-body text-decoration-underline" [routerLink]="authService.isAuthorized('visites_show') ? '/visites': null">Visite au sol</a></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">1800 km</h5>
                        <!-- each visit has edges - each edge has a length -->
                        <!-- get sum of length of visits of this team (all time ? month) -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0"><a class="text-body text-decoration-underline" [routerLink]="authService.isAuthorized('anomalies_show') ? '/anomalies': null">Anomalies réalisées</a></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">20%</h5>
                        <!-- each team has a visites - each visit has anomalies -->
                        <!-- get total anomalies with status true of this team (all time) -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">
                            <a class="text-body text-decoration-underline" [routerLink]="authService.isAuthorized('anomalies_show') ? '/anomalies': null">Nombre d'incidents
                            <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small>
                            <span role="status" class="spinner-grow text-danger ms-1" style="width: 0.4rem; height: 0.4rem;vertical-align: 0.475em;"></span>
                            </a>
                        </p>
                        <!-- each mission has a depar - each depar has a team -->
                        <!-- get sum of mission type:true of this team of this month -->
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">Nombre de coupures <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                        <!-- each mission has a depar - each depar has a team -->
                        <!-- get sum of mission type:false of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">Nombre de clients coupés <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                        <!-- each mission has a node - each node has a post - each post has clients count -->
                        <!-- get sum of clients count of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">Nombre de postes coupés <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                        <!-- each mission has a node - each node has a post -->
                        <!-- get sum of post  of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">DMS <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">0.45</h5>
                        <!-- each mission has DMS -->
                        <!-- get sum of DMS  of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">IFS <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">0.32</h5>
                        <!-- each mission has IFS -->
                        <!-- get sum of IFS  of this team of this month -->
                    </td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>
        <div class="col-4">
            <div class="card card-body">
                <div class="card-title"><i class="fas fa-circle me-1 text-warning"></i> Equipe 1</div>

                <table class="table table-centered align-middle table-nowrap">
                <tbody>
                    <tr>
                    <td class="w-50">
                        <p class="mb-0"><a class="text-body text-decoration-underline" [routerLink]="authService.isAuthorized('visites_show') ? '/visites': null">Visite au sol</a></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">1800 km</h5>
                        <!-- each visit has edges - each edge has a length -->
                        <!-- get sum of length of visits of this team (all time ? month) -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0"><a class="text-body text-decoration-underline" [routerLink]="authService.isAuthorized('anomalies_show') ? '/anomalies': null">Anomalies réalisées</a></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">20%</h5>
                        <!-- each team has a visites - each visit has anomalies -->
                        <!-- get total anomalies with status true of this team (all time) -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">
                            <a class="text-body text-decoration-underline" [routerLink]="authService.isAuthorized('anomalies_show') ? '/anomalies': null">Nombre d'incidents
                            <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small>
                            <span role="status" class="spinner-grow text-danger ms-1" style="width: 0.4rem; height: 0.4rem;vertical-align: 0.475em;"></span>
                            </a>
                        </p>
                        <!-- each mission has a depar - each depar has a team -->
                        <!-- get sum of mission type:true of this team of this month -->
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">Nombre de coupures <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                        <!-- each mission has a depar - each depar has a team -->
                        <!-- get sum of mission type:false of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">Nombre de clients coupés <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                        <!-- each mission has a node - each node has a post - each post has clients count -->
                        <!-- get sum of clients count of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">Nombre de postes coupés <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">102</h5>
                        <!-- each mission has a node - each node has a post -->
                        <!-- get sum of post  of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">DMS <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">0.45</h5>
                        <!-- each mission has DMS -->
                        <!-- get sum of DMS  of this team of this month -->
                    </td>
                    </tr>
                    
                    <tr>
                    <td class="w-50">
                        <p class="mb-0">IFS <small class="text-muted">({{today | date:'MMM':'Africa/Casablanca'}})</small></p>
                    </td>
                    <td class="w-50 text-end">
                        <h5 class="mb-0">0.32</h5>
                        <!-- each mission has IFS -->
                        <!-- get sum of IFS  of this team of this month -->
                    </td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- charts -->
    <div class="row">
    
    <div class="col-6">
      <div class="card card-body">
        <div class="fw-bold mb-4">
          DMS <small class="text-muted font-size-12">(Durée moyenne des interruptions de l'année en cours)</small>
        </div>
        <apx-chart
          [series]="DMSChart.series"
          [chart]="DMSChart.chart"
          [xaxis]="DMSChart.xaxis"
          [stroke]="DMSChart.stroke"
          [tooltip]="DMSChart.tooltip"
          [dataLabels]="DMSChart.dataLabels"
          [colors]="DMSChart.colors"
        ></apx-chart>
      </div>
    </div>
    <div class="col-6">
      <div class="card card-body">
        <div class="fw-bold mb-4">
          IFS <small class="text-muted font-size-12">(Fréquence des interruptions de l'année en cours)</small>
        </div>
        <apx-chart
          [series]="IFSChart.series"
          [chart]="IFSChart.chart"
          [xaxis]="IFSChart.xaxis"
          [stroke]="IFSChart.stroke"
          [tooltip]="IFSChart.tooltip"
          [dataLabels]="IFSChart.dataLabels"
          [colors]="IFSChart.colors"
        ></apx-chart>
      </div>
    </div>
    <div class="col-6">
      <div class="card card-body">
        <div class="fw-bold mb-4">
        L'évolution historique des anomalies
        </div>
        <apx-chart
            [series]="AnomaliesPerTeamChart.series"
            [chart]="AnomaliesPerTeamChart.chart"
            [dataLabels]="AnomaliesPerTeamChart.dataLabels"
            [plotOptions]="AnomaliesPerTeamChart.plotOptions"
            [responsive]="AnomaliesPerTeamChart.responsive"
            [xaxis]="AnomaliesPerTeamChart.xaxis"
            [legend]="AnomaliesPerTeamChart.legend"
            [fill]="AnomaliesPerTeamChart.fill"
        ></apx-chart>
         
      </div>
    </div>
    </div>
</div> <!-- container-fluid -->
