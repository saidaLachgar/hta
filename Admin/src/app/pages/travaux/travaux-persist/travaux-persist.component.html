
<div class="container-fluid pb-5 mb-5">
  <!-- start page title -->
  <app-page-title
    title=""
    [breadcrumbItems]="breadCrumbItems"
  ></app-page-title>
  <!-- end page title -->

  <form class="row mt-4" [formGroup]="service.travauxForm">
    <div class="col-12">
      <div class="card">
        <div class="card-body">

          <button 
            [class.d-none]="!EditeMode || !service.interruption" 
            (click)="service.deleteItem()"
            type="button" class="btn text-danger float-end fw-medium btn-light">
            <i class="mdi mdi-trash-can align-middle me-2"></i>Supprimer
          </button>

          <button 
            routerLink="/travaux"
            class="btn btn-light me-2 float-end text-muted"
            ><i class="fas fa-arrow-circle-left me-1"></i>Retour à la liste</button>

          <div class="card-title mb-5">
            Formulaire d'interruption 
            <div role="status" class="spinner-grow ms-1 spinner-grow-sm text-primary" *ngIf="service.loading$ | async"><span class="sr-only">Loading...</span></div>
          </div>
          <div class="row">
            <div class="col-6">

                <!-- Départements -->
              <label>Départ</label>
              <ng-select [items]="service.departements$ | async"
                        formControlName="departement"
                        bindLabel="titre"
                        bindValue="@id"
                        [minTermLength]="2"
                        [loading]="service.departementLoading"
                        typeToSearchText="Veuillez saisir 2 caractères ou plus"
                        [typeahead]="service.departementInput$">
              </ng-select>

              <!-- PS -->
              <label class="mt-3">PS</label>
              <ng-select [items]="service.ps$ | async"
                        formControlName="ps"
                        bindLabel="titre"
                        bindValue="@id"
                        [multiple]="true"
                        [minTermLength]="2"
                        [loading]="service.psLoading"
                        typeToSearchText="Veuillez saisir 2 caractères ou plus"
                        [typeahead]="service.psInput$">
              </ng-select>

              <!-- Date -->
              <label class="mt-3">Date</label>
              <div class="input-group clockpicker">
                <input ngbDatepicker formControlName="date" class="form-control" (click)="ds.open()" #ds="ngbDatepicker">
              </div>
              <div class="mt-3 row">
                <div class="col-6">
                  <label>De</label>
                  <ng-template #dateStartTemplate>
                    <ngb-timepicker formControlName="dateStart" seconds="true"></ngb-timepicker>
                  </ng-template>
                  <input class="form-control bg-white" [value]="dateStart" readonly [ngbPopover]="dateStartTemplate" [autoClose]="'outside'" placement="bottom" />
                </div>
                <div class="col-6">
                  <label>à</label>
                  <ng-template #dateEndTemplate>
                    <ngb-timepicker formControlName="dateEnd" seconds="true"></ngb-timepicker>
                  </ng-template>
                  <input class="form-control bg-white" [value]="dateEnd" readonly [ngbPopover]="dateEndTemplate" [autoClose]="'outside'" placement="bottom" />
                </div>
              </div>

            </div>
            <div class="col-6">

              <!-- Source -->
              <label>Point coupure</label>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  formControlName="source"
                  id="source-1"
                  value="0"
                />
                <label class="form-check-label" for="source-1">
                  Départ
                </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  formControlName="source"
                  id="source-2"
                  value="1"
                />
                <label class="form-check-label" for="source-2">
                  Appareil de coupeur
                </label>
              </div>
              <ng-select class="ms-3 mt-2" [class.disabled]="service.source.value==0" [items]="service.appareils$ | async"
                        formControlName="appareil"
                        bindLabel="titre"
                        bindValue="@id"
                        [minTermLength]="2"
                        [loading]="service.appareilLoading"
                        typeToSearchText="Veuillez saisir 2 caractères ou plus"
                        [typeahead]="service.appareilInput$">
              </ng-select>

              <!-- Type -->
              <label class="mt-3">Type</label>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  formControlName="type"
                  id="type-1"
                  value="true"
                />
                <label class="form-check-label" for="type-1">
                  Déclenchement
                </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  formControlName="type"
                  id="type-2"
                  value="false"
                />
                <label class="form-check-label" for="type-2">
                  Coupeur / Ouverture
                </label>
              </div>
              
              <!-- Causes -->
              <ng-container *ngIf="service.type.value!='false'">
                <label class="mt-3">Causes</label>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    formControlName="causes"
                    id="causes-1"
                    value="1"
                  />
                  <label class="form-check-label" for="causes-1">
                    Défauts matériels
                  </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    formControlName="causes"
                    id="causes-2"
                    value="2"
                  />
                  <label class="form-check-label" for="causes-2">
                    Telescopare
                  </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    formControlName="causes"
                    id="causes-3"
                    value="3"
                  />
                  <label class="form-check-label" for="causes-3">
                    Intenpaire 
                  </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    formControlName="causes"
                    id="causes-4"
                    value="4"
                  />
                  <label class="form-check-label" for="causes-4">
                    Cause inconnue
                  </label>
                </div>
              </ng-container>

            </div>
          </div>
          
        </div>
      </div>
    </div>
    <!-- end col -->

    <form class="col-12" (ngSubmit)="addAnomaly(anomalyInput.value); anomalyInput.value = ''">
      <div class="card card-body">
        <h4 class="card-title mb-4">Anomalies</h4>
        <div class="input-group">
          <input type="text" name="description" class="form-control bg-light border-0" #anomalyInput placeholder='Nouvelle anomalie' aria-describedby="basic-addon1">
          <div class="input-group-prepend">
              <span class="input-group-text bg-light rounded-lg border-0 shadow-none" id="basic-addon1"><button type="submit" class="btn btn-link p-0 text-primary" style="outline:none;">Ajouter</button></span>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table table-nowrap align-middle mb-0">
            <tbody>
              <tr *ngFor="let list of anomalies; let i = index">
                <td style="width: 40px;" class="pe-0">
                  <div class="form-check font-size-16">
                    <input type="checkbox" class="form-check-input" #test{{i}} id="customCheck{{i}}" (click)="checkAnomaly(!list.checked,i)"
                      [checked]="list.checked">
                    <label class="form-check-label" for="customCheck{{i}}"></label>
                  </div>
                </td>
                <td class="ps-0">
                  <p class="text-truncate font-size-14 m-0 text-dark" [class.line-through]="list.checked">{{list.title}}</p>
                </td>
                <td style="width: 61px;">
                  <div class="avatar-group">
                    <div class="avatar-group-item">
                      <a href="javascript: void(0);" class="d-inline-block">
                        <img src="https://avatars.dicebear.com/api/initials/{{list.username}}.svg" title="{{list.username}}" alt="" class="rounded-circle avatar-xs">
                      </a>
                    </div>
                  </div>
                </td>
                <td style="width: 34px;">
                  <div class="text-end">
                    <i class="fas fa-times c-pointer text-primary" (click)="removeAnomaly(i)"></i>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </form>
  </form>
  <!-- end row -->
</div>

