"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[996],{9167:(P,_,o)=>{o.d(_,{p:()=>g});var t=o(3668),v=o(7317),c=o(7686);let g=(()=>{class p{constructor(u,e){this.router=u,this.authService=e}canActivate(u,e){return!!this.authService.isAuthorized(u.data.access)||(alert("acc\xe8s refus\xe9"),this.router.navigate(["/dashboard"]),!1)}}return p.\u0275fac=function(u){return new(u||p)(t.\u0275\u0275inject(v.F0),t.\u0275\u0275inject(c.$))},p.\u0275prov=t.\u0275\u0275defineInjectable({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()},4996:(P,_,o)=>{o.r(_),o.d(_,{UserPermissionsModule:()=>G});var t=o(7317),v=o(9167),c=o(9133),g=o(6813),p=o(1366);const h=[{name:"Travaux",value:"missions",related:!0,permissions:[0,1,2,3,4]},{name:"Anomalies",value:"anomalies",related:!0,permissions:[0,1,2,3,4]},{name:"Visites",value:"visites",related:!0,permissions:[0,1,2,3,4]},{name:"D\xe9part",value:"departments",related:!0,permissions:[0,1,2,3,4]},{name:"Dps",value:"dps",related:!0,permissions:[0,1,2,3,4]},{name:"Commune",value:"communes",related:!0,permissions:[0,1,2,3,4]},{name:"Tron\xe7on",value:"edges",related:!0,permissions:-1},{name:"Postes",value:"postes",related:!0,permissions:-1},{name:"Appareils coupeur",value:"nodes",related:!0,permissions:[0,1,2,3,4]},{name:"\xc9tat du suivi",value:"objectives",permissions:[0,1,2,4]},{name:"Groupe d'objectif",value:"goal_groups",permissions:[0,1,2,3,4]},{name:"Objectives",value:"goals",permissions:[0,1,2,3,4]},{name:"\xc9quipes",value:"teams",permissions:[0,1,2,3,4]},{name:"Members",value:"users",permissions:[0,1,2,3,4]},{name:"Profile",value:"profile",permissions:0},{name:"Statistiques",value:"statistiques",permissions:4},{name:"Autorisation",value:"autorisation",permissions:4},{name:"Historique",value:"logs",permissions:4}],u=[{name:"Modifier",value:"update"},{name:"Supprimer",value:"delete"},{name:"Ajouter",value:"add"},{name:"Details",value:"details"},{name:"Afficher",value:"show"},{name:"Exporter",value:"export"},{name:"Importer",value:"import"}];var e=o(3668),d=o(1429),m=o(8274),x=o(7686),I=o(1950),C=o(6019),E=o(6015);let S=(()=>{class n{transform(s){return typeof s}}return n.\u0275fac=function(s){return new(s||n)},n.\u0275pipe=e.\u0275\u0275definePipe({name:"typeof",type:n,pure:!0}),n})();function U(n,a){1&n&&e.\u0275\u0275element(0,"i",10)}function O(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"th"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const s=a.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(s.name)}}function T(n,a){1&n&&(e.\u0275\u0275elementStart(0,"small",31),e.\u0275\u0275text(1," (Seul concern\xe9)"),e.\u0275\u0275elementEnd())}function A(n,a){if(1&n){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"label",28),e.\u0275\u0275elementStart(2,"input",29),e.\u0275\u0275listener("change",function(i){e.\u0275\u0275restoreView(s);const l=e.\u0275\u0275nextContext(4).$implicit;return e.\u0275\u0275nextContext(2).onChange(i,l.role)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,T,2,0,"small",30),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&n){const s=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext(2).$implicit,l=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("title",s.name),e.\u0275\u0275advance(1),e.\u0275\u0275property("formArrayName",i.role)("value",r.value+"_"+s.value)("checked",l.isChecked(r.value+"_"+s.value,i.role)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","ROLE_SUPER_ADMIN"!=i.role&&"show"==s.value&&r.related)}}function j(n,a){1&n&&(e.\u0275\u0275elementStart(0,"label"),e.\u0275\u0275element(1,"input",32),e.\u0275\u0275elementEnd())}function M(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"td"),e.\u0275\u0275template(1,A,4,5,"ng-container",26),e.\u0275\u0275pipe(2,"typeof"),e.\u0275\u0275pipe(3,"typeof"),e.\u0275\u0275template(4,j,2,0,"ng-template",null,27,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&n){const s=a.index,r=e.\u0275\u0275reference(5),i=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",-1===i.permissions||"number"===e.\u0275\u0275pipeBind1(2,2,i.permissions)&&s==i.permissions||"object"===e.\u0275\u0275pipeBind1(3,4,i.permissions)&&i.permissions.indexOf(s)>-1)("ngIfElse",r)}}function N(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"tr"),e.\u0275\u0275elementStart(1,"th"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,M,6,6,"td",25),e.\u0275\u0275elementEnd()),2&n){const s=a.$implicit,r=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(s.name),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",r.PermissionsIndex)}}function F(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275elementStart(1,"table",24),e.\u0275\u0275elementStart(2,"thead"),e.\u0275\u0275elementStart(3,"tr"),e.\u0275\u0275element(4,"th"),e.\u0275\u0275template(5,O,2,1,"th",25),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"tbody"),e.\u0275\u0275template(7,N,4,2,"tr",25),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&n){const s=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",s.PermissionsIndex),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",s.EntitiesAccess)}}function $(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"li",20),e.\u0275\u0275elementStart(1,"a",21),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,F,8,2,"ng-template",22),e.\u0275\u0275elementEnd()),2&n){const s=a.$implicit;e.\u0275\u0275property("ngbNavItem",a.index),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(s.label)}}function D(n,a){1&n&&e.\u0275\u0275element(0,"i",33)}function L(n,a){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",11),e.\u0275\u0275elementStart(2,"ul",12,13),e.\u0275\u0275template(4,$,5,2,"li",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"div",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",16),e.\u0275\u0275elementStart(7,"div",17),e.\u0275\u0275elementStart(8,"button",18),e.\u0275\u0275template(9,D,1,0,"i",19),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275text(11," Sauvegarder "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&n){const s=a.ngIf,r=e.\u0275\u0275reference(3),i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("activeId",0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",s),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbNavOutlet",r),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",i.submitted&&e.\u0275\u0275pipeBind1(10,4,i.service.loading$))}}const B=[{path:"",component:(()=>{class n{constructor(s,r,i,l){this.service=s,this.fb=r,this.toast=i,this.auth=l,this.submitted=!1,this.EntitiesAccess=h,this.PermissionsIndex=u,this.form=r.group({}),this.UserPermissions$=s.getAll().pipe((0,p.b)(f=>{let b={};f.forEach(y=>{b[y.role]=new c.Oe([]),y.permissions&&y.permissions.forEach(V=>{b[y.role].push(new c.NI(V))})}),this.form=r.group(b),this.OldPermissions=f}))}isChecked(s,r){return this.form.get(r).controls.filter(l=>l.value==s).length}onChange(s,r){const i=this.form.get(r),l=s.target;l.checked?i.push(new c.NI(l.value)):i.controls.forEach((f,b)=>{f.value!=l.value||i.removeAt(b)})}onSubmit(){this.submitted=!0;let s=this.form.value,r=this.toast,i=[];this.OldPermissions.forEach(l=>{if(!((n,a)=>{const s=[...new Set(n).values()],r=[...new Set(a).values()];return s.length==r.length&&s.every(i=>r.includes(i))})(l.permissions,s[l.role])){console.log("create an observable");let f=Object.assign({},l);f.permissions=s[l.role],i.push(this.service.update(f))}}),i.length&&(i.push(this.auth.refreshToken()),(0,g.D)(i).subscribe({error:()=>r.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){r.success("Les permissions ont \xe9t\xe9 mises \xe0 jour avec succ\xe8s"),this.submitted=!1,setTimeout(()=>location.reload(),1e3)}}))}}return n.\u0275fac=function(s){return new(s||n)(e.\u0275\u0275directiveInject(d.Q),e.\u0275\u0275directiveInject(c.qu),e.\u0275\u0275directiveInject(m.jE),e.\u0275\u0275directiveInject(x.$))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["app-users-list"]],decls:21,vars:8,consts:[[1,"container-fluid"],["title","Autorisation des utilisateurs",3,"breadcrumbItems"],[1,"alert","alert-info","mt-3"],[1,"alert-heading"],[1,"row","mt-4",3,"formGroup","ngSubmit"],[1,"col-12"],[1,"card"],[1,"card-body"],["class","bx bx-loader-alt fa-spin text-center fs-1 text-primary d-block m-5",4,"ngIf"],[4,"ngIf"],[1,"bx","bx-loader-alt","fa-spin","text-center","fs-1","text-primary","d-block","m-5"],[1,"row"],["ngbNav","",1,"nav-tabs",3,"activeId"],["nav","ngbNav"],[3,"ngbNavItem",4,"ngFor","ngForOf"],[3,"ngbNavOutlet"],[1,"row","justify-content-end"],[1,"col-auto"],[1,"btn","btn-primary"],["class","bx bx-loader-alt fa-spin",4,"ngIf"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[1,"table-responsive","mt-4"],[1,"table","table-striped","table-bordered"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["disabled",""],[3,"title"],["type","checkbox",3,"formArrayName","value","checked","change"],["class","text-muted",4,"ngIf"],[1,"text-muted"],["type","checkbox","disabled","",2,"opacity","0.3"],[1,"bx","bx-loader-alt","fa-spin"]],template:function(s,r){1&s&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-page-title",1),e.\u0275\u0275elementStart(2,"div",2),e.\u0275\u0275elementStart(3,"h6",3),e.\u0275\u0275text(4,"La dur\xe9e de la session"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(5," Pour que les changements soient imm\xe9diatement pris en compte, l'utilisateur doit se d\xe9connecter et s'authentifier \xe0 nouveau."),e.\u0275\u0275element(6,"br"),e.\u0275\u0275text(7," Sinon les changements seront effectu\xe9s lorsque la session expire ou l'utilisateur n'est pas autoris\xe9 \xe0 une interface."),e.\u0275\u0275element(8,"br"),e.\u0275\u0275elementStart(9,"small"),e.\u0275\u0275text(10,"La session de l'utilisateur est mise \xe0 jour "),e.\u0275\u0275elementStart(11,"b"),e.\u0275\u0275text(12,"chaque 5 min"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"form",4),e.\u0275\u0275listener("ngSubmit",function(){return r.onSubmit()}),e.\u0275\u0275elementStart(14,"fieldset",5),e.\u0275\u0275elementStart(15,"div",6),e.\u0275\u0275elementStart(16,"div",7),e.\u0275\u0275template(17,U,1,0,"i",8),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275template(19,L,12,6,"ng-container",9),e.\u0275\u0275pipe(20,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&s&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("breadcrumbItems",r.breadCrumbItems),e.\u0275\u0275advance(12),e.\u0275\u0275property("formGroup",r.form),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!r.submitted&&e.\u0275\u0275pipeBind1(18,4,r.service.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(20,6,r.UserPermissions$)))},directives:[I.V,c._Y,c.JL,c.sg,C.NgIf,E.Pz,C.NgForOf,E.tO,E.nv,E.Vx,E.uN,c.CE],pipes:[C.AsyncPipe,S],encapsulation:2}),n})(),canActivate:[v.p],data:{access:"autorisation_show"}}];let w=(()=>{class n{}return n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=e.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=e.\u0275\u0275defineInjector({imports:[[t.Bz.forChild(B)],t.Bz]}),n})();var z=o(9922);let G=(()=>{class n{}return n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=e.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=e.\u0275\u0275defineInjector({imports:[[w,z.m]]}),n})()},1950:(P,_,o)=>{o.d(_,{V:()=>u});var t=o(3668),v=o(6019);function c(e,d){1&e&&(t.\u0275\u0275elementStart(0,"div",8),t.\u0275\u0275elementStart(1,"span",9),t.\u0275\u0275text(2,"Loading..."),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd())}function g(e,d){if(1&e&&(t.\u0275\u0275elementStart(0,"li",12),t.\u0275\u0275elementStart(1,"a",13),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd()),2&e){const m=t.\u0275\u0275nextContext().$implicit;t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(m.label)}}function p(e,d){if(1&e&&(t.\u0275\u0275elementStart(0,"li",14),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),2&e){const m=t.\u0275\u0275nextContext().$implicit;t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1("",m.label," ")}}function h(e,d){if(1&e&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,g,3,1,"li",10),t.\u0275\u0275template(2,p,2,1,"li",11),t.\u0275\u0275elementContainerEnd()),2&e){const m=d.$implicit;t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!m.active),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",m.active)}}let u=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(m){return new(m||e)},e.\u0275cmp=t.\u0275\u0275defineComponent({type:e,selectors:[["app-page-title"]],inputs:{breadcrumbItems:"breadcrumbItems",title:"title",Loading:"Loading"},decls:9,vars:3,consts:[[1,"row"],[1,"col-12"],[1,"page-title-box","d-flex","align-items-center","justify-content-between"],[1,"mb-0","font-size-18"],["role","status","class","spinner-grow ms-1 spinner-grow-sm text-primary",4,"ngIf"],[1,"page-title-right","d-none","d-md-block"],[1,"breadcrumb","m-0"],[4,"ngFor","ngForOf"],["role","status",1,"spinner-grow","ms-1","spinner-grow-sm","text-primary"],[1,"sr-only"],["class","breadcrumb-item",4,"ngIf"],["class","breadcrumb-item active",4,"ngIf"],[1,"breadcrumb-item"],["href","javascript: void(0);"],[1,"breadcrumb-item","active"]],template:function(m,x){1&m&&(t.\u0275\u0275elementStart(0,"div",0),t.\u0275\u0275elementStart(1,"div",1),t.\u0275\u0275elementStart(2,"div",2),t.\u0275\u0275elementStart(3,"h4",3),t.\u0275\u0275text(4),t.\u0275\u0275template(5,c,3,0,"div",4),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(6,"div",5),t.\u0275\u0275elementStart(7,"ol",6),t.\u0275\u0275template(8,h,3,2,"ng-container",7),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd()),2&m&&(t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate1(" ",x.title," "),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",x.Loading),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngForOf",x.breadcrumbItems))},directives:[v.NgIf,v.NgForOf],encapsulation:2}),e})()}}]);