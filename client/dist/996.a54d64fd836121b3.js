"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[996],{9167:(I,v,l)=>{l.d(v,{p:()=>g});var i=l(3668),f=l(7317),c=l(7686);let g=(()=>{class p{constructor(u,e){this.router=u,this.authService=e}canActivate(u,e){return!!this.authService.isAuthorized(u.data.access)||(alert("acc\xe8s refus\xe9"),this.router.navigate(["/dashboard"]),!1)}}return p.\u0275fac=function(u){return new(u||p)(i.\u0275\u0275inject(f.F0),i.\u0275\u0275inject(c.$))},p.\u0275prov=i.\u0275\u0275defineInjectable({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()},4996:(I,v,l)=>{l.r(v),l.d(v,{UserPermissionsModule:()=>z});var i=l(7317),f=l(9167),c=l(9133),g=l(6813),p=l(1366);const x=[{name:"Anomalies",value:"anomalies",permissions:-1},{name:"Mission",value:"missions",permissions:-1},{name:"Calendrier",value:"calendrier",permissions:4},{name:"Visites",value:"visites",permissions:-1},{name:"\xc9tat du suivi",value:"objectives",permissions:[0,1,2,4]},{name:"Groupe d'objectif",value:"goal_groups",permissions:-1},{name:"Objectives",value:"goals",permissions:-1},{name:"Postes",value:"postes",permissions:-1},{name:"Statistiques",value:"statistiques",permissions:4},{name:"\xc9quipes",value:"teams",permissions:-1},{name:"D\xe9part",value:"departments",permissions:-1},{name:"Dps",value:"dps",permissions:-1},{name:"Commune",value:"communes",permissions:-1},{name:"Tron\xe7on",value:"edges",permissions:-1},{name:"Appareils coupeur",value:"nodes",permissions:-1},{name:"Members",value:"users",permissions:-1},{name:"Autorisation",value:"autorisation",permissions:4},{name:"Historique",value:"logs",permissions:4},{name:"Source des donn\xe9es",value:"data",permissions:4}],u=[{name:"Modifier",value:"update"},{name:"Supprimer",value:"delete"},{name:"Ajouter",value:"add"},{name:"Details",value:"details"},{name:"Afficher",value:"show"}];var e=l(3668),d=l(1429),m=l(8274),h=l(7686),y=l(1950),P=l(6019),C=l(6015);let S=(()=>{class t{transform(n){return typeof n}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275pipe=e.\u0275\u0275definePipe({name:"typeof",type:t,pure:!0}),t})();function U(t,o){1&t&&e.\u0275\u0275element(0,"i",8)}function T(t,o){if(1&t){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275elementStart(1,"label"),e.\u0275\u0275elementStart(2,"input",32),e.\u0275\u0275listener("change",function(r){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275nextContext(4).$implicit;return e.\u0275\u0275nextContext(2).onChange(r,a.role)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()}if(2&t){const n=o.$implicit,s=e.\u0275\u0275nextContext(2).$implicit,r=e.\u0275\u0275nextContext(2).$implicit,a=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("formArrayName",r.role)("value",s.value+"_"+n.value)("checked",a.isChecked(s.value+"_"+n.value,r.role)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.name," ")}}function O(t,o){if(1&t&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,T,4,4,"div",31),e.\u0275\u0275elementContainerEnd()),2&t){const n=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",n.PermissionsIndex)}}function A(t,o){if(1&t){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"label"),e.\u0275\u0275elementStart(2,"input",32),e.\u0275\u0275listener("change",function(r){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275nextContext(4).$implicit;return e.\u0275\u0275nextContext(2).onChange(r,a.role)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&t){const n=e.\u0275\u0275nextContext(2).$implicit,s=e.\u0275\u0275nextContext(2).$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("formArrayName",s.role)("value",n.value+"_"+r.PermissionsIndex[n.permissions].value)("checked",r.isChecked(n.value+"_"+r.PermissionsIndex[n.permissions].value,s.role)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",r.PermissionsIndex[n.permissions].name," ")}}function $(t,o){if(1&t&&(e.\u0275\u0275template(0,A,4,4,"ng-container",28),e.\u0275\u0275pipe(1,"typeof")),2&t){const n=e.\u0275\u0275nextContext().$implicit,s=e.\u0275\u0275reference(8);e.\u0275\u0275property("ngIf","number"===e.\u0275\u0275pipeBind1(1,2,n.permissions))("ngIfElse",s)}}function j(t,o){if(1&t){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275elementStart(1,"label"),e.\u0275\u0275elementStart(2,"input",32),e.\u0275\u0275listener("change",function(r){e.\u0275\u0275restoreView(n);const a=e.\u0275\u0275nextContext(4).$implicit;return e.\u0275\u0275nextContext(2).onChange(r,a.role)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()}if(2&t){const n=o.$implicit,s=e.\u0275\u0275nextContext(2).$implicit,r=e.\u0275\u0275nextContext(2).$implicit,a=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("formArrayName",r.role)("value",s.value+"_"+a.PermissionsIndex[n].value)("checked",a.isChecked(s.value+"_"+a.PermissionsIndex[n].value,r.role)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",a.PermissionsIndex[n].name," ")}}function F(t,o){if(1&t&&e.\u0275\u0275template(0,j,4,4,"div",31),2&t){const n=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("ngForOf",n.permissions)}}function M(t,o){if(1&t&&(e.\u0275\u0275elementStart(0,"div",25),e.\u0275\u0275elementStart(1,"h5",26),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",27),e.\u0275\u0275template(4,O,2,1,"ng-container",28),e.\u0275\u0275template(5,$,2,4,"ng-template",null,29,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(7,F,1,1,"ng-template",null,30,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"hr"),e.\u0275\u0275elementEnd()),2&t){const n=o.$implicit,s=e.\u0275\u0275reference(6);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n.name),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",-1===n.permissions)("ngIfElse",s)}}function N(t,o){if(1&t&&(e.\u0275\u0275elementStart(0,"div",9),e.\u0275\u0275template(1,M,10,3,"div",24),e.\u0275\u0275elementEnd()),2&t){const n=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",n.EntitiesAccess)}}function w(t,o){if(1&t&&(e.\u0275\u0275elementStart(0,"li",18),e.\u0275\u0275elementStart(1,"a",19),e.\u0275\u0275elementStart(2,"span",20),e.\u0275\u0275element(3,"i",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span",22),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,N,2,1,"ng-template",23),e.\u0275\u0275elementEnd()),2&t){const n=o.$implicit;e.\u0275\u0275property("ngbNavItem",o.index),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(n.label)}}function D(t,o){1&t&&e.\u0275\u0275element(0,"i",33)}function R(t,o){if(1&t&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",9),e.\u0275\u0275elementStart(2,"ul",10,11),e.\u0275\u0275template(4,w,7,2,"li",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"div",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",14),e.\u0275\u0275elementStart(7,"div",15),e.\u0275\u0275elementStart(8,"button",16),e.\u0275\u0275template(9,D,1,0,"i",17),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275text(11," Sauvegarder "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&t){const n=o.ngIf,s=e.\u0275\u0275reference(3),r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("activeId",0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbNavOutlet",s),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",r.submitted&&e.\u0275\u0275pipeBind1(10,4,r.service.loading$))}}const B=[{path:"",component:(()=>{class t{constructor(n,s,r,a){this.service=n,this.fb=s,this.toast=r,this.auth=a,this.submitted=!1,this.EntitiesAccess=x,this.PermissionsIndex=u,this.form=s.group({}),this.UserPermissions$=n.getAll().pipe((0,p.b)(_=>{let E={};_.forEach(b=>{E[b.role]=new c.Oe([]),b.permissions&&b.permissions.forEach(G=>{E[b.role].push(new c.NI(G))})}),this.form=s.group(E),this.OldPermissions=_}))}isChecked(n,s){return this.form.get(s).controls.filter(a=>a.value==n).length}onChange(n,s){const r=this.form.get(s),a=n.target;a.checked?r.push(new c.NI(a.value)):r.controls.forEach((_,E)=>{_.value!=a.value||r.removeAt(E)})}onSubmit(){this.submitted=!0;let n=this.form.value,s=this.toast,r=[];this.OldPermissions.forEach(a=>{if(!((t,o)=>{const n=[...new Set(t).values()],s=[...new Set(o).values()];return n.length==s.length&&n.every(r=>s.includes(r))})(a.permissions,n[a.role])){console.log("create an observable");let _=Object.assign({},a);_.permissions=n[a.role],r.push(this.service.update(_))}}),r.length&&(r.push(this.auth.refreshToken()),(0,g.D)(r).subscribe({error:()=>s.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){s.success("Les permissions ont \xe9t\xe9 mises \xe0 jour avec succ\xe8s"),this.submitted=!1,setTimeout(()=>location.reload(),1e3)}}))}}return t.\u0275fac=function(n){return new(n||t)(e.\u0275\u0275directiveInject(d.Q),e.\u0275\u0275directiveInject(c.qu),e.\u0275\u0275directiveInject(m.jE),e.\u0275\u0275directiveInject(h.$))},t.\u0275cmp=e.\u0275\u0275defineComponent({type:t,selectors:[["app-users-list"]],decls:10,vars:8,consts:[[1,"container-fluid"],["title","Autorisation des utilisateurs",3,"breadcrumbItems"],[1,"row","mt-4",3,"formGroup","ngSubmit"],[1,"col-12"],[1,"card"],[1,"card-body"],["class","bx bx-loader-alt fa-spin text-center fs-1 text-primary d-block m-5",4,"ngIf"],[4,"ngIf"],[1,"bx","bx-loader-alt","fa-spin","text-center","fs-1","text-primary","d-block","m-5"],[1,"row"],["ngbNav","",1,"nav-tabs",3,"activeId"],["nav","ngbNav"],[3,"ngbNavItem",4,"ngFor","ngForOf"],[3,"ngbNavOutlet"],[1,"row","justify-content-end"],[1,"col-auto"],[1,"btn","btn-primary"],["class","bx bx-loader-alt fa-spin",4,"ngIf"],[3,"ngbNavItem"],["ngbNavLink",""],[1,"d-block","d-sm-none"],[1,"fas","fa-home"],[1,"d-none","d-sm-block"],["ngbNavContent",""],["class","col-6 mt-4",4,"ngFor","ngForOf"],[1,"col-6","mt-4"],[1,"mb-3"],[1,"ms-3"],[4,"ngIf","ngIfElse"],["second",""],["third",""],[4,"ngFor","ngForOf"],["type","checkbox",3,"formArrayName","value","checked","change"],[1,"bx","bx-loader-alt","fa-spin"]],template:function(n,s){1&n&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-page-title",1),e.\u0275\u0275elementStart(2,"form",2),e.\u0275\u0275listener("ngSubmit",function(){return s.onSubmit()}),e.\u0275\u0275elementStart(3,"fieldset",3),e.\u0275\u0275elementStart(4,"div",4),e.\u0275\u0275elementStart(5,"div",5),e.\u0275\u0275template(6,U,1,0,"i",6),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275template(8,R,12,6,"ng-container",7),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("breadcrumbItems",s.breadCrumbItems),e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",s.form),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!s.submitted&&e.\u0275\u0275pipeBind1(7,4,s.service.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(9,6,s.UserPermissions$)))},directives:[y.V,c._Y,c.JL,c.sg,P.NgIf,C.Pz,P.NgForOf,C.tO,C.nv,C.Vx,C.uN,c.CE],pipes:[P.AsyncPipe,S],encapsulation:2}),t})(),canActivate:[f.p],data:{access:"autorisation_show"}}];let V=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=e.\u0275\u0275defineInjector({imports:[[i.Bz.forChild(B)],i.Bz]}),t})();var k=l(9922);let z=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=e.\u0275\u0275defineInjector({imports:[[V,k.m]]}),t})()},1950:(I,v,l)=>{l.d(v,{V:()=>u});var i=l(3668),f=l(6019);function c(e,d){1&e&&(i.\u0275\u0275elementStart(0,"div",8),i.\u0275\u0275elementStart(1,"span",9),i.\u0275\u0275text(2,"Loading..."),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementEnd())}function g(e,d){if(1&e&&(i.\u0275\u0275elementStart(0,"li",12),i.\u0275\u0275elementStart(1,"a",13),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementEnd()),2&e){const m=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(m.label)}}function p(e,d){if(1&e&&(i.\u0275\u0275elementStart(0,"li",14),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),2&e){const m=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275advance(1),i.\u0275\u0275textInterpolate1("",m.label," ")}}function x(e,d){if(1&e&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275template(1,g,3,1,"li",10),i.\u0275\u0275template(2,p,2,1,"li",11),i.\u0275\u0275elementContainerEnd()),2&e){const m=d.$implicit;i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",!m.active),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",m.active)}}let u=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(m){return new(m||e)},e.\u0275cmp=i.\u0275\u0275defineComponent({type:e,selectors:[["app-page-title"]],inputs:{breadcrumbItems:"breadcrumbItems",title:"title",Loading:"Loading"},decls:9,vars:3,consts:[[1,"row"],[1,"col-12"],[1,"page-title-box","d-flex","align-items-center","justify-content-between"],[1,"mb-0","font-size-18"],["role","status","class","spinner-grow ms-1 spinner-grow-sm text-primary",4,"ngIf"],[1,"page-title-right"],[1,"breadcrumb","m-0"],[4,"ngFor","ngForOf"],["role","status",1,"spinner-grow","ms-1","spinner-grow-sm","text-primary"],[1,"sr-only"],["class","breadcrumb-item",4,"ngIf"],["class","breadcrumb-item active",4,"ngIf"],[1,"breadcrumb-item"],["href","javascript: void(0);"],[1,"breadcrumb-item","active"]],template:function(m,h){1&m&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275elementStart(1,"div",1),i.\u0275\u0275elementStart(2,"div",2),i.\u0275\u0275elementStart(3,"h4",3),i.\u0275\u0275text(4),i.\u0275\u0275template(5,c,3,0,"div",4),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(6,"div",5),i.\u0275\u0275elementStart(7,"ol",6),i.\u0275\u0275template(8,x,3,2,"ng-container",7),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementEnd()),2&m&&(i.\u0275\u0275advance(4),i.\u0275\u0275textInterpolate1(" ",h.title," "),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",h.Loading),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngForOf",h.breadcrumbItems))},directives:[f.NgIf,f.NgForOf],encapsulation:2}),e})()}}]);