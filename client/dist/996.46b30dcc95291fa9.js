"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[996],{9167:(P,v,o)=>{o.d(v,{p:()=>g});var n=o(3668),_=o(7317),c=o(7686);let g=(()=>{class p{constructor(u,e){this.router=u,this.authService=e}canActivate(u,e){return!!this.authService.isAuthorized(u.data.access)||(alert("acc\xe8s refus\xe9"),this.router.navigate(["/dashboard"]),!1)}}return p.\u0275fac=function(u){return new(u||p)(n.\u0275\u0275inject(_.F0),n.\u0275\u0275inject(c.$))},p.\u0275prov=n.\u0275\u0275defineInjectable({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()},4996:(P,v,o)=>{o.r(v),o.d(v,{UserPermissionsModule:()=>G});var n=o(7317),_=o(9167),c=o(9133),g=o(6813),p=o(1366);const x=[{name:"Travaux",value:"missions",related:!0,permissions:[0,1,2,3,4]},{name:"Anomalies",value:"anomalies",related:!0,permissions:[0,1,2,3,4]},{name:"Visites",value:"visites",related:!0,permissions:[0,1,2,3,4]},{name:"D\xe9part",value:"departments",related:!0,permissions:[0,1,2,3,4]},{name:"Dps",value:"dps",related:!0,permissions:[0,1,2,3,4]},{name:"Commune",value:"communes",related:!0,permissions:[0,1,2,3,4]},{name:"Tron\xe7on",value:"edges",related:!0,permissions:-1},{name:"Postes",value:"postes",related:!0,permissions:-1},{name:"Appareils coupure",value:"nodes",related:!0,permissions:[0,1,2,3,4]},{name:"\xc9tat du suivi",value:"objectives",permissions:[0,1,2,4]},{name:"Groupe d'objectif",value:"goal_groups",permissions:[0,1,2,3,4]},{name:"Objectives",value:"goals",permissions:[0,1,2,3,4]},{name:"\xc9quipes",value:"teams",related:!0,permissions:[0,1,2,3,4]},{name:"Members",value:"users",related:!0,permissions:[0,1,2,3,4]},{name:"Profile",value:"profile",permissions:0},{name:"Statistiques",value:"statistiques",related:!0,permissions:4},{name:"Autorisation",value:"autorisation",permissions:4},{name:"Historique",value:"logs",permissions:4}],u=[{name:"Modifier",value:"update"},{name:"Supprimer",value:"delete"},{name:"Ajouter",value:"add"},{name:"Details",value:"details"},{name:"Afficher",value:"show"},{name:"Exporter",value:"export"},{name:"Importer",value:"import"}];var e=o(3668),d=o(1429),m=o(8274),h=o(7686),I=o(1950),C=o(6019),E=o(6015);let S=(()=>{class t{transform(r){return typeof r}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275pipe=e.\u0275\u0275definePipe({name:"typeof",type:t,pure:!0}),t})();function O(t,a){1&t&&e.\u0275\u0275element(0,"i",10)}function U(t,a){if(1&t&&(e.\u0275\u0275elementStart(0,"div",30),e.\u0275\u0275elementStart(1,"span",31),e.\u0275\u0275element(2,"i",32),e.\u0275\u0275text(3," Toutes les donn\xe9es"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span"),e.\u0275\u0275element(5,"i",33),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&t){const r=e.\u0275\u0275nextContext(2).$implicit;e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" Donn\xe9es relatives \xe0 ","ROLE_ADMIN"==r.role?"la DP":"l'\xe9quipe","")}}function T(t,a){if(1&t&&(e.\u0275\u0275elementStart(0,"th",34),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&t){const r=a.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(r.name)}}function A(t,a){if(1&t){const r=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",39),e.\u0275\u0275elementStart(2,"input",40),e.\u0275\u0275listener("change",function(i){e.\u0275\u0275restoreView(r);const l=e.\u0275\u0275nextContext(4).$implicit;return e.\u0275\u0275nextContext(2).onChange(i,l.role)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&t){const r=e.\u0275\u0275nextContext().$implicit,s=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext(2).$implicit,l=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("title",r.name),e.\u0275\u0275property("ngClass","ROLE_SUPER_ADMIN"!=i.role&&"show"==r.value&&s.related?"form-check-warning":"form-check-info"),e.\u0275\u0275advance(1),e.\u0275\u0275property("formArrayName",i.role)("value",s.value+"_"+r.value)("checked",l.isChecked(s.value+"_"+r.value,i.role))}}function F(t,a){1&t&&(e.\u0275\u0275elementStart(0,"label"),e.\u0275\u0275element(1,"input",41),e.\u0275\u0275elementEnd())}function M(t,a){if(1&t&&(e.\u0275\u0275elementStart(0,"td",36),e.\u0275\u0275template(1,A,3,5,"ng-container",37),e.\u0275\u0275pipe(2,"typeof"),e.\u0275\u0275pipe(3,"typeof"),e.\u0275\u0275template(4,F,2,0,"ng-template",null,38,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&t){const r=a.index,s=e.\u0275\u0275reference(5),i=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",-1===i.permissions||"number"===e.\u0275\u0275pipeBind1(2,2,i.permissions)&&r==i.permissions||"object"===e.\u0275\u0275pipeBind1(3,4,i.permissions)&&i.permissions.indexOf(r)>-1)("ngIfElse",s)}}function N(t,a){if(1&t&&(e.\u0275\u0275elementStart(0,"tr"),e.\u0275\u0275elementStart(1,"th"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,M,6,6,"td",35),e.\u0275\u0275elementEnd()),2&t){const r=a.$implicit,s=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(r.name),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",s.PermissionsIndex)}}function j(t,a){if(1&t&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275template(1,U,7,1,"div",24),e.\u0275\u0275elementStart(2,"div",25),e.\u0275\u0275elementStart(3,"table",26),e.\u0275\u0275elementStart(4,"thead"),e.\u0275\u0275elementStart(5,"tr",27),e.\u0275\u0275element(6,"th"),e.\u0275\u0275template(7,T,2,1,"th",28),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"tbody"),e.\u0275\u0275template(9,N,4,2,"tr",29),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&t){const r=e.\u0275\u0275nextContext().$implicit,s=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","ROLE_SUPER_ADMIN"!=r.role),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",s.PermissionsIndex),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",s.EntitiesAccess)}}function D(t,a){if(1&t&&(e.\u0275\u0275elementStart(0,"li",20),e.\u0275\u0275elementStart(1,"a",21),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,j,10,3,"ng-template",22),e.\u0275\u0275elementEnd()),2&t){const r=a.$implicit;e.\u0275\u0275property("ngbNavItem",a.index),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(r.label)}}function $(t,a){1&t&&e.\u0275\u0275element(0,"i",42)}function L(t,a){if(1&t&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",11),e.\u0275\u0275elementStart(2,"ul",12,13),e.\u0275\u0275template(4,D,5,2,"li",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"div",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",16),e.\u0275\u0275elementStart(7,"div",17),e.\u0275\u0275elementStart(8,"button",18),e.\u0275\u0275template(9,$,1,0,"i",19),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275text(11," Sauvegarder "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&t){const r=a.ngIf,s=e.\u0275\u0275reference(3),i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("activeId",0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",r),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbNavOutlet",s),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",i.submitted&&e.\u0275\u0275pipeBind1(10,4,i.service.loading$))}}const w=[{path:"",component:(()=>{class t{constructor(r,s,i,l){this.service=r,this.fb=s,this.toast=i,this.auth=l,this.submitted=!1,this.EntitiesAccess=x,this.PermissionsIndex=u,this.form=s.group({}),this.UserPermissions$=r.getAll().pipe((0,p.b)(f=>{let b={};f.forEach(y=>{b[y.role]=new c.Oe([]),y.permissions&&y.permissions.forEach(k=>{b[y.role].push(new c.NI(k))})}),this.form=s.group(b),this.OldPermissions=f}))}isChecked(r,s){return this.form.get(s).controls.filter(l=>l.value==r).length}onChange(r,s){const i=this.form.get(s),l=r.target;l.checked?i.push(new c.NI(l.value)):i.controls.forEach((f,b)=>{f.value!=l.value||i.removeAt(b)})}onSubmit(){this.submitted=!0;let r=this.form.value,s=this.toast,i=[];this.OldPermissions.forEach(l=>{if(!((t,a)=>{const r=[...new Set(t).values()],s=[...new Set(a).values()];return r.length==s.length&&r.every(i=>s.includes(i))})(l.permissions,r[l.role])){console.log("create an observable");let f=Object.assign({},l);f.permissions=r[l.role],i.push(this.service.update(f))}}),i.length&&(i.push(this.auth.refreshToken()),(0,g.D)(i).subscribe({error:()=>s.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){s.success("Les permissions ont \xe9t\xe9 mises \xe0 jour avec succ\xe8s"),this.submitted=!1,setTimeout(()=>location.reload(),1e3)}}))}}return t.\u0275fac=function(r){return new(r||t)(e.\u0275\u0275directiveInject(d.Q),e.\u0275\u0275directiveInject(c.qu),e.\u0275\u0275directiveInject(m.jE),e.\u0275\u0275directiveInject(h.$))},t.\u0275cmp=e.\u0275\u0275defineComponent({type:t,selectors:[["app-users-list"]],decls:18,vars:8,consts:[[1,"container-fluid"],["title","Autorisation des utilisateurs",3,"breadcrumbItems"],[1,"alert","alert-info","mt-3"],[1,"alert-heading"],[1,"row","mt-4",3,"formGroup","ngSubmit"],[1,"col-12"],[1,"card"],[1,"card-body"],["class","bx bx-loader-alt fa-spin text-center fs-1 text-primary d-block m-5",4,"ngIf"],[4,"ngIf"],[1,"bx","bx-loader-alt","fa-spin","text-center","fs-1","text-primary","d-block","m-5"],[1,"row"],["ngbNav","",1,"nav-tabs",3,"activeId"],["nav","ngbNav"],[3,"ngbNavItem",4,"ngFor","ngForOf"],[3,"ngbNavOutlet"],[1,"row","justify-content-end"],[1,"col-auto"],[1,"btn","btn-primary"],["class","bx bx-loader-alt fa-spin",4,"ngIf"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[1,"border-top-0","pt-1","mb-3",2,"margin","0 -12px","border","1px solid #ced4da"],["class","my-3 ps-3",4,"ngIf"],[1,"table-responsive"],[1,"table","table-hover","table-bordered"],[1,"text-center"],["width","95px",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"my-3","ps-3"],[1,"me-3"],[1,"text-info","fas","fa-circle"],[1,"text-warning","fas","fa-circle"],["width","95px"],["align","center",4,"ngFor","ngForOf"],["align","center"],[4,"ngIf","ngIfElse"],["disabled",""],[3,"title","ngClass"],["type","checkbox",1,"form-check-input",3,"formArrayName","value","checked","change"],["type","checkbox","disabled","",2,"opacity","0.3"],[1,"bx","bx-loader-alt","fa-spin"]],template:function(r,s){1&r&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-page-title",1),e.\u0275\u0275elementStart(2,"div",2),e.\u0275\u0275elementStart(3,"h6",3),e.\u0275\u0275text(4,"La dur\xe9e de la session"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(5," Pour que les changements soient imm\xe9diatement pris en compte, l'utilisateur doit se d\xe9connecter et s'authentifier \xe0 nouveau."),e.\u0275\u0275element(6,"br"),e.\u0275\u0275text(7," Sinon les changements seront effectu\xe9s lorsque la session expire ou l'utilisateur n'est pas autoris\xe9 \xe0 une interface."),e.\u0275\u0275element(8,"br"),e.\u0275\u0275text(9," La session de l'utilisateur s'actualise chaque 5 minutes. "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"form",4),e.\u0275\u0275listener("ngSubmit",function(){return s.onSubmit()}),e.\u0275\u0275elementStart(11,"fieldset",5),e.\u0275\u0275elementStart(12,"div",6),e.\u0275\u0275elementStart(13,"div",7),e.\u0275\u0275template(14,O,1,0,"i",8),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275template(16,L,12,6,"ng-container",9),e.\u0275\u0275pipe(17,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&r&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("breadcrumbItems",s.breadCrumbItems),e.\u0275\u0275advance(9),e.\u0275\u0275property("formGroup",s.form),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!s.submitted&&e.\u0275\u0275pipeBind1(15,4,s.service.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(17,6,s.UserPermissions$)))},directives:[I.V,c._Y,c.JL,c.sg,C.NgIf,E.Pz,C.NgForOf,E.tO,E.nv,E.Vx,E.uN,C.NgClass,c.CE],pipes:[C.AsyncPipe,S],encapsulation:2}),t})(),canActivate:[_.p],data:{access:"autorisation_show"}}];let B=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=e.\u0275\u0275defineInjector({imports:[[n.Bz.forChild(w)],n.Bz]}),t})();var z=o(9922);let G=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=e.\u0275\u0275defineInjector({imports:[[B,z.m]]}),t})()},1950:(P,v,o)=>{o.d(v,{V:()=>u});var n=o(3668),_=o(6019);function c(e,d){1&e&&(n.\u0275\u0275elementStart(0,"div",8),n.\u0275\u0275elementStart(1,"span",9),n.\u0275\u0275text(2,"Loading..."),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementEnd())}function g(e,d){if(1&e&&(n.\u0275\u0275elementStart(0,"li",12),n.\u0275\u0275elementStart(1,"a",13),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementEnd()),2&e){const m=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(m.label)}}function p(e,d){if(1&e&&(n.\u0275\u0275elementStart(0,"li",14),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()),2&e){const m=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate1("",m.label," ")}}function x(e,d){if(1&e&&(n.\u0275\u0275elementContainerStart(0),n.\u0275\u0275template(1,g,3,1,"li",10),n.\u0275\u0275template(2,p,2,1,"li",11),n.\u0275\u0275elementContainerEnd()),2&e){const m=d.$implicit;n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",!m.active),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",m.active)}}let u=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(m){return new(m||e)},e.\u0275cmp=n.\u0275\u0275defineComponent({type:e,selectors:[["app-page-title"]],inputs:{breadcrumbItems:"breadcrumbItems",title:"title",Loading:"Loading"},decls:9,vars:3,consts:[[1,"row"],[1,"col-12"],[1,"page-title-box","d-flex","align-items-center","justify-content-between"],[1,"mb-0","font-size-18"],["role","status","class","spinner-grow ms-1 spinner-grow-sm text-primary",4,"ngIf"],[1,"page-title-right","d-none","d-md-block"],[1,"breadcrumb","m-0"],[4,"ngFor","ngForOf"],["role","status",1,"spinner-grow","ms-1","spinner-grow-sm","text-primary"],[1,"sr-only"],["class","breadcrumb-item",4,"ngIf"],["class","breadcrumb-item active",4,"ngIf"],[1,"breadcrumb-item"],["href","javascript: void(0);"],[1,"breadcrumb-item","active"]],template:function(m,h){1&m&&(n.\u0275\u0275elementStart(0,"div",0),n.\u0275\u0275elementStart(1,"div",1),n.\u0275\u0275elementStart(2,"div",2),n.\u0275\u0275elementStart(3,"h4",3),n.\u0275\u0275text(4),n.\u0275\u0275template(5,c,3,0,"div",4),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(6,"div",5),n.\u0275\u0275elementStart(7,"ol",6),n.\u0275\u0275template(8,x,3,2,"ng-container",7),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementEnd()),2&m&&(n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate1(" ",h.title," "),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",h.Loading),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngForOf",h.breadcrumbItems))},directives:[_.NgIf,_.NgForOf],encapsulation:2}),e})()}}]);