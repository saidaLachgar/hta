"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[798],{5630:(j,y,r)=>{r.d(y,{ob:()=>T,Su:()=>B});var s=r(3668),v=r(9133),c=r(6019);function I(l,f){if(1&l&&(s.\u0275\u0275elementStart(0,"label",2),s.\u0275\u0275elementStart(1,"span",3),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(3,"span",4),s.\u0275\u0275text(4),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementEnd()),2&l){const e=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275styleProp("color",e.getColor("checkedTextColor")),s.\u0275\u0275attribute("aria-label",e.checkedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate(e.checkedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275styleProp("color",e.getColor("uncheckedTextColor")),s.\u0275\u0275attribute("aria-label",e.uncheckedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate(e.uncheckedLabel)}}const L=["*"],p=new s.InjectionToken("UI_SWITCH_OPTIONS"),S={provide:v.JU,useExisting:(0,s.forwardRef)(()=>T),multi:!0};let T=(()=>{class l{constructor(e={},a){this.cdr=a,this.change=new s.EventEmitter,this.changeEvent=new s.EventEmitter,this.valueChange=new s.EventEmitter,this.onTouchedCallback=R=>{},this.onChangeCallback=R=>{},this.size=e&&e.size||"medium",this.color=e&&e.color,this.switchOffColor=e&&e.switchOffColor,this.switchColor=e&&e.switchColor,this.defaultBgColor=e&&e.defaultBgColor,this.defaultBoColor=e&&e.defaultBoColor,this.checkedLabel=e&&e.checkedLabel,this.uncheckedLabel=e&&e.uncheckedLabel,this.checkedTextColor=e&&e.checkedTextColor,this.uncheckedTextColor=e&&e.uncheckedTextColor}set checked(e){this._checked=!1!==e}get checked(){return this._checked}set disabled(e){this._disabled=!1!==e}get disabled(){return this._disabled}set reverse(e){this._reverse=!1!==e}get reverse(){return this._reverse}set loading(e){this._loading=!1!==e}get loading(){return this._loading}getColor(e=""){return"borderColor"===e?this.defaultBoColor:"switchColor"===e?this.reverse?this.checked&&this.switchOffColor||this.switchColor:this.checked?this.switchColor:this.switchOffColor||this.switchColor:"checkedTextColor"===e?this.reverse?this.uncheckedTextColor:this.checkedTextColor:"uncheckedTextColor"===e?this.reverse?this.checkedTextColor:this.uncheckedTextColor:this.reverse?this.checked?this.defaultBgColor:this.color:this.checked?this.color:this.defaultBgColor}onClick(e){this.disabled||(this.checked=!this.checked,this.change.emit(this.checked),this.valueChange.emit(this.checked),this.changeEvent.emit(e),this.onChangeCallback(this.checked),this.onTouchedCallback(this.checked),this.cdr.markForCheck())}onToggle(e){this.disabled||(this.beforeChange?this._beforeChange=this.beforeChange.subscribe(a=>{a&&this.onClick(e)}):this.onClick(e))}writeValue(e){e!==this.checked&&(this.checked=!!e),this.onChangeCallback(this.checked),this.cdr&&this.cdr.markForCheck()}registerOnChange(e){this.onChangeCallback=e}registerOnTouched(e){this.onTouchedCallback=e}setDisabledState(e){this.disabled=e}ngOnDestroy(){this._beforeChange&&this._beforeChange.unsubscribe()}}return l.\u0275fac=function(e){return new(e||l)(s.\u0275\u0275directiveInject(p,8),s.\u0275\u0275directiveInject(s.ChangeDetectorRef))},l.\u0275cmp=s.\u0275\u0275defineComponent({type:l,selectors:[["ui-switch"]],hostBindings:function(e,a){1&e&&s.\u0275\u0275listener("click",function(A){return a.onToggle(A)})},inputs:{size:"size",color:"color",switchOffColor:"switchOffColor",switchColor:"switchColor",defaultBgColor:"defaultBgColor",defaultBoColor:"defaultBoColor",checkedLabel:"checkedLabel",uncheckedLabel:"uncheckedLabel",checkedTextColor:"checkedTextColor",uncheckedTextColor:"uncheckedTextColor",checked:"checked",disabled:"disabled",reverse:"reverse",loading:"loading",beforeChange:"beforeChange"},outputs:{change:"change",changeEvent:"changeEvent",valueChange:"valueChange"},features:[s.\u0275\u0275ProvidersFeature([S])],ngContentSelectors:L,decls:4,vars:20,consts:[["type","button","role","switch",1,"switch"],["class","switch-pane",4,"ngIf"],[1,"switch-pane"],[1,"switch-label-checked"],[1,"switch-label-unchecked"]],template:function(e,a){1&e&&(s.\u0275\u0275projectionDef(),s.\u0275\u0275elementStart(0,"button",0),s.\u0275\u0275template(1,I,5,8,"label",1),s.\u0275\u0275elementStart(2,"small"),s.\u0275\u0275projection(3),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementEnd()),2&e&&(s.\u0275\u0275styleProp("background-color",a.getColor())("border-color",a.getColor("borderColor")),s.\u0275\u0275classProp("checked",a.checked)("disabled",a.disabled)("loading",a.loading)("switch-large","large"===a.size)("switch-medium","medium"===a.size)("switch-small","small"===a.size),s.\u0275\u0275attribute("aria-checked",a.checked),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",a.checkedLabel||a.uncheckedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275styleProp("background",a.getColor("switchColor")))},directives:[c.NgIf],encapsulation:2}),l})(),B=(()=>{class l{static forRoot(e){return{ngModule:l,providers:[{provide:p,useValue:e||{}}]}}}return l.\u0275fac=function(e){return new(e||l)},l.\u0275mod=s.\u0275\u0275defineNgModule({type:l}),l.\u0275inj=s.\u0275\u0275defineInjector({imports:[[c.CommonModule,v.u5],v.u5]}),l})()},5826:(j,y,r)=>{r.d(y,{l:()=>s,o:()=>v});var s=(()=>{return(c=s||(s={}))[c["D\xe9fauts mat\xe9riels"]=0]="D\xe9fauts mat\xe9riels",c[c["Tiers/corps \xe9tranger"]=1]="Tiers/corps \xe9tranger",c[c.Intemp\u00e9ries=2]="Intemp\xe9ries",c[c["Cause inconnue"]=3]="Cause inconnue",s;var c})();const v=[{label:"Urgent < mois",value:"ELEVE",color:"danger"},{label:"Court terme < 1an",value:"FAIBLE",color:"warning"},{label:"Faible terme > 1an",value:"NORMAL",color:"success"},{label:"Autre",value:"OTHER",color:"info"}]},4038:(j,y,r)=>{r.d(y,{M:()=>b});var s=r(4762),v=r(1824),c=r(3405),I=r(4099),L=r(3596),p=r(2411),S=r(5686),T=r(5389),B=r(8735),l=r(1366),f=r(9204),e=r(2047),a=r(8053),R=r(5826),A=r(8260),E=r(3668),W=r(5633),K=r(6761),U=r(7777),x=r(4885),n=r(5565),d=r(4522),_=r(8274);const u=m=>""!==m?m.year+"-"+m.month+"-"+("0"+m.day).slice(-2):"";let b=(()=>{class m extends v.c8{constructor(t,i,o,h,g,O,P,D){super("anomalies",t),this.serviceElementsFactory=t,this.confirmDialogService=i,this.departmentService=o,this.communeService=h,this.edgeService=g,this.userService=O,this.http=P,this.toast=D,this.pageSize=A.N.pageSize,this.server=A.N.serverURL,this.severityOptions=R.o,this.departmentLoading=!1,this.departmentInput$=new c.xQ,this.usersLoading=!1,this.usersInput$=new c.xQ,this.edgesInRange$=new I.X([]),this.edgesLoading=!1,this.edgesInput$=new c.xQ,this.submitted=!1,this.statusLoading=0,this.page=1}findAll(){this.findByCriteria({page:1})}loadDepartments(t=!0){this.departments$=t?(0,L.z)((0,p.of)([]),this.departmentInput$.pipe((0,S.b)(500),(0,T.x)(),(0,B.h)(i=>null!=i),(0,l.b)(()=>this.departmentLoading=!0),(0,f.w)(i=>this.departmentService.getWithQuery("properties[]=id&properties[]=titre&titre="+i).pipe((0,e.K)(()=>(0,p.of)([])),(0,l.b)(()=>this.departmentLoading=!1))))):this.departmentService.getWithQuery("properties[]=id&properties[]=titre")}loadUsers(t=[]){this.users$=(0,L.z)((0,p.of)(t),this.usersInput$.pipe((0,S.b)(500),(0,T.x)(),(0,B.h)(i=>null!=i),(0,l.b)(()=>this.usersLoading=!0),(0,f.w)(i=>this.userService.getWithQuery("properties[]=id&properties[]=fullName&fullName="+i).pipe((0,e.K)(()=>(0,p.of)([])),(0,l.b)(()=>this.usersLoading=!1)))))}loadEdgesInRange(t,i){let o=Object.assign({},t);o["id[]"]=i,o["properties[]"]="id",o["properties[node_a][]"]="titre",o["properties[node_b][]"]="titre",o.pagination="false",delete o.node_a,delete o.page,o.node_b&&delete o.node_b,this.edgeService.getWithQuery(o).subscribe(h=>{this.edgesInRange$.next(h)})}loadEdgesByDepar(t){this.edge.reset(),this.edgesInRange$.next([]),this.edgeService.getWithQuery("properties[]=id&properties[]=node_a&properties[]=node_b&itemsPerPage=1000&department.id="+t.match(/\d+/)[0]).subscribe(i=>{this.edgesInRange$.next(i)})}getPagination(){this.pagination$=(0,p.of)(),this.pagination$=this.selectors$.entityActions$.pipe((0,a.U)(t=>t.payload.pagination))}deleteItem(t,i){this.confirmDialogService.setConfirmation("Vous \xeates s\xfbr de vouloir supprimer?",()=>{this.delete(t).pipe(this.toast.observe({loading:"Suppression...",success:()=>(i.closest("tr").remove(),"Anomaly supprim\xe9 avec succ\xe8s"),error:"un probl\xe8me est survenu, veuillez r\xe9essayer"})).subscribe()})}onSearch(){this.page=1,this.lastSearchedParams=this.anomalyForm.value,this.findByCriteria(Object.assign({page:1},this.lastSearchedParams))}onCreate(){let t=this.anomalyForm;if(this.submitted=!0,t.invalid)return;this.submitted=!1;let i=this.toast,o=Object.entries(t.value);const h=Object.fromEntries(o.filter(([g,O])=>""!==O));this.add(h).subscribe({error:()=>i.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){t.reset(),i.success("Anomaly ajout\xe9 avec succ\xe8s")}})}onUpdate(t){let i=this.anomalyForm;if(this.submitted=!0,i.invalid)return;this.submitted=!1;let o=this.toast,h=Object.entries(i.value);const g=Object.fromEntries(h.filter(([O,P])=>""!==P));g.id=t,this.update(g).subscribe({error:()=>o.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){o.success("Anomaly a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}updateStatus(t,i){t.stopPropagation();let o=this,g={id:i,status:!t.target.classList.contains("checked")};this.statusLoading=i,this.update(g).subscribe({error:()=>o.toast.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){o.statusLoading=0,o.toast.success("Statut a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}bulkCreate(t){return this.http.post(`${this.server}/api/anomalies/bulk?action=create`,{anomalies:t})}getRelatedAnomalies(t,i,o,h=!1,g=null){t&&""!==t.trim()&&this.findByCriteria(Object.assign(Object.assign({page:1},{node_a:t.match(/\d+/)[0],depar:o.match(/\d+/)[0]}),i&&0!==i.length&&{node_b:i.map(O=>O.match(/\d+/)[0])}),!0,h,g)}findByCriteria(t,i=!1,o=!1,h=null){var g,O;return(0,s.mG)(this,void 0,void 0,function*(){if(this.anomalies$=(0,p.of)([]),Object.keys(t).length>1){const D=M=>t[M]&&delete Object.assign(t,{["createdAt["+M+"]"]:u(t[M])})[M];if(D("before"),D("after"),t.node_a){let M=yield this.edgeService.getEdgesInRange(t.depar,t.node_a,t.node_b?t.node_b:null).toPromise();this.loadEdgesInRange(t,M),t["edge.id[]"]=M,delete t.node_a,t.node_b&&delete t.node_b}}let P=Object.keys(t).filter(D=>""!=t[D]&&null!=t[D]).reduce((D,M)=>Object.assign(Object.assign({},D),{[M]:t[M]}),{});h&&(P["createdAt[after]"]=h.split("T")[0]+"T00:00:00",P["createdAt[before]"]=h.split("T")[0]+"T23:59:59"),o&&(P.status=!1),i&&(null===(O=!(null===(g=P["edge.id[]"])||void 0===g?void 0:g.length))||void 0===O||O)&&(P["edge.id[]"]=1e9),this.anomalies$=this.getWithQuery(P),this.getPagination()})}onPaginate(t){this.findByCriteria(Object.assign({page:t},this.lastSearchedParams))}getSeverity(t,i){const o=this.severityOptions.find(h=>h.value===t);return o?i?o.color:o.label:""}get department(){return this.anomalyForm.get("department")}get title(){return this.anomalyForm.get("title")}get edge(){return this.anomalyForm.get("edge")}}return m.\u0275fac=function(t){return new(t||m)(E.\u0275\u0275inject(v.yV),E.\u0275\u0275inject(W.D),E.\u0275\u0275inject(K.l),E.\u0275\u0275inject(U.s),E.\u0275\u0275inject(x.p),E.\u0275\u0275inject(n.K),E.\u0275\u0275inject(d.eN),E.\u0275\u0275inject(_.jE))},m.\u0275prov=E.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},5565:(j,y,r)=>{r.d(y,{K:()=>K});var s=r(1824),v=r(3405),c=r(3596),I=r(2411),L=r(5686),p=r(5389),S=r(8735),T=r(1366),B=r(9204),l=r(8053),f=r(2047),e=r(8260),a=r(3668),R=r(5633),A=r(4522),E=r(7686),W=r(8274);let K=(()=>{class U extends s.c8{constructor(n,d,_,u,b){super("users",n),this.serviceElementsFactory=n,this.confirmDialogService=d,this.http=_,this.authService=u,this.toast=b,this.pageSize=e.N.pageSize,this.server=e.N.serverURL,this.teamLoading=!1,this.teamInput$=new v.xQ,this.submitted=!1,this.loading=!1,this.page=1}findAll(){this.findByCriteria({page:1})}loadTeams(n=[]){this.teams$=(0,c.z)((0,I.of)(n),this.teamInput$.pipe((0,L.b)(500),(0,p.x)(),(0,S.h)(d=>null!=d),(0,T.b)(()=>this.teamLoading=!0),(0,B.w)(d=>this.http.get(`${this.server}/api/teams?properties[]=id&properties[]=titre&titre=`+d).pipe((0,l.U)(_=>_["hydra:member"]),(0,f.K)(()=>(0,I.of)([])),(0,T.b)(()=>this.teamLoading=!1)))))}getPagination(){this.pagination$=(0,I.of)(),this.pagination$=this.selectors$.entityActions$.pipe((0,l.U)(n=>n.payload.pagination))}deleteItem(n,d){this.confirmDialogService.setConfirmation("Vous \xeates s\xfbr de vouloir supprimer?",()=>{this.delete(n).pipe(this.toast.observe({loading:"Suppression...",success:()=>(d.closest("tr").remove(),"Utilisateur supprim\xe9 avec succ\xe8s"),error:"un probl\xe8me est survenu, veuillez r\xe9essayer"})).subscribe()})}onSearch(){this.page=1,this.lastSearchedParams=this.userForm.value,this.findByCriteria(Object.assign({page:1},this.lastSearchedParams))}onCreate(){let n=this.userForm;if(this.submitted=!0,n.invalid)return;this.submitted=!1;let d=this.toast,_=Object.entries(n.value);const u=Object.fromEntries(_.filter(([b,m])=>""!==m));u.roles=[u.roles.toString()],this.add(u).subscribe({error:()=>d.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){n.reset(),d.success("Utilisateur ajout\xe9 avec succ\xe8s")}})}onUpdate(n,d=!1){let _=this.userForm;if(this.submitted=!0,_.invalid)return;this.submitted=!1;let u=this,b=this.toast,m=this.authService.user,C=Object.assign({},_.value);C.id=n,d?C=Object.entries(C).reduce((t,[i,o])=>(""!==o&&null!==o&&(t[i]=o),t),{}):C.roles=[C.roles.toString()],this.update(C).subscribe({error:()=>b.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){m.id==n?(u.loading=!0,u.authService.logout(!1),u.authService.login(C.username,C.password).subscribe({error:t=>{t&&b.error(t.error.message),u.loading=!1},complete(){u.loading=!1,b.success("L'utilisateur a \xe9t\xe9 mis \xe0 jour avec succ\xe8s"),setTimeout(()=>window.location.reload(),10)}})):b.success("L'utilisateur a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}get fullName(){return this.userForm.get("fullName")}get username(){return this.userForm.get("username")}get password(){return this.userForm.get("password")}get roles(){return this.userForm.get("roles")}get team(){return this.userForm.get("team")}findByCriteria(n){this.users$=(0,I.of)([]);let d=Object.keys(n).filter(_=>""!=n[_]&&null!=n[_]).reduce((_,u)=>Object.assign(Object.assign({},_),{[u]:n[u]}),{});this.users$=this.getWithQuery(d),this.getPagination()}onPaginate(n){this.findByCriteria(Object.assign({page:n},this.lastSearchedParams))}}return U.\u0275fac=function(n){return new(n||U)(a.\u0275\u0275inject(s.yV),a.\u0275\u0275inject(R.D),a.\u0275\u0275inject(A.eN),a.\u0275\u0275inject(E.$),a.\u0275\u0275inject(W.jE))},U.\u0275prov=a.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"}),U})()}}]);