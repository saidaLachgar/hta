"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[798],{5630:(L,P,r)=>{r.d(P,{ob:()=>f,Su:()=>I});var t=r(3668),E=r(9133),h=r(6019);function C(n,v){if(1&n&&(t.\u0275\u0275elementStart(0,"label",2),t.\u0275\u0275elementStart(1,"span",3),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(3,"span",4),t.\u0275\u0275text(4),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd()),2&n){const e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275styleProp("color",e.getColor("checkedTextColor")),t.\u0275\u0275attribute("aria-label",e.checkedLabel),t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate(e.checkedLabel),t.\u0275\u0275advance(1),t.\u0275\u0275styleProp("color",e.getColor("uncheckedTextColor")),t.\u0275\u0275attribute("aria-label",e.uncheckedLabel),t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate(e.uncheckedLabel)}}const M=["*"],m=new t.InjectionToken("UI_SWITCH_OPTIONS"),b={provide:E.JU,useExisting:(0,t.forwardRef)(()=>f),multi:!0};let f=(()=>{class n{constructor(e={},a){this.cdr=a,this.change=new t.EventEmitter,this.changeEvent=new t.EventEmitter,this.valueChange=new t.EventEmitter,this.onTouchedCallback=T=>{},this.onChangeCallback=T=>{},this.size=e&&e.size||"medium",this.color=e&&e.color,this.switchOffColor=e&&e.switchOffColor,this.switchColor=e&&e.switchColor,this.defaultBgColor=e&&e.defaultBgColor,this.defaultBoColor=e&&e.defaultBoColor,this.checkedLabel=e&&e.checkedLabel,this.uncheckedLabel=e&&e.uncheckedLabel,this.checkedTextColor=e&&e.checkedTextColor,this.uncheckedTextColor=e&&e.uncheckedTextColor}set checked(e){this._checked=!1!==e}get checked(){return this._checked}set disabled(e){this._disabled=!1!==e}get disabled(){return this._disabled}set reverse(e){this._reverse=!1!==e}get reverse(){return this._reverse}set loading(e){this._loading=!1!==e}get loading(){return this._loading}getColor(e=""){return"borderColor"===e?this.defaultBoColor:"switchColor"===e?this.reverse?this.checked&&this.switchOffColor||this.switchColor:this.checked?this.switchColor:this.switchOffColor||this.switchColor:"checkedTextColor"===e?this.reverse?this.uncheckedTextColor:this.checkedTextColor:"uncheckedTextColor"===e?this.reverse?this.checkedTextColor:this.uncheckedTextColor:this.reverse?this.checked?this.defaultBgColor:this.color:this.checked?this.color:this.defaultBgColor}onClick(e){this.disabled||(this.checked=!this.checked,this.change.emit(this.checked),this.valueChange.emit(this.checked),this.changeEvent.emit(e),this.onChangeCallback(this.checked),this.onTouchedCallback(this.checked),this.cdr.markForCheck())}onToggle(e){this.disabled||(this.beforeChange?this._beforeChange=this.beforeChange.subscribe(a=>{a&&this.onClick(e)}):this.onClick(e))}writeValue(e){e!==this.checked&&(this.checked=!!e),this.onChangeCallback(this.checked),this.cdr&&this.cdr.markForCheck()}registerOnChange(e){this.onChangeCallback=e}registerOnTouched(e){this.onTouchedCallback=e}setDisabledState(e){this.disabled=e}ngOnDestroy(){this._beforeChange&&this._beforeChange.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.\u0275\u0275directiveInject(m,8),t.\u0275\u0275directiveInject(t.ChangeDetectorRef))},n.\u0275cmp=t.\u0275\u0275defineComponent({type:n,selectors:[["ui-switch"]],hostBindings:function(e,a){1&e&&t.\u0275\u0275listener("click",function(y){return a.onToggle(y)})},inputs:{size:"size",color:"color",switchOffColor:"switchOffColor",switchColor:"switchColor",defaultBgColor:"defaultBgColor",defaultBoColor:"defaultBoColor",checkedLabel:"checkedLabel",uncheckedLabel:"uncheckedLabel",checkedTextColor:"checkedTextColor",uncheckedTextColor:"uncheckedTextColor",checked:"checked",disabled:"disabled",reverse:"reverse",loading:"loading",beforeChange:"beforeChange"},outputs:{change:"change",changeEvent:"changeEvent",valueChange:"valueChange"},features:[t.\u0275\u0275ProvidersFeature([b])],ngContentSelectors:M,decls:4,vars:20,consts:[["type","button","role","switch",1,"switch"],["class","switch-pane",4,"ngIf"],[1,"switch-pane"],[1,"switch-label-checked"],[1,"switch-label-unchecked"]],template:function(e,a){1&e&&(t.\u0275\u0275projectionDef(),t.\u0275\u0275elementStart(0,"button",0),t.\u0275\u0275template(1,C,5,8,"label",1),t.\u0275\u0275elementStart(2,"small"),t.\u0275\u0275projection(3),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementEnd()),2&e&&(t.\u0275\u0275styleProp("background-color",a.getColor())("border-color",a.getColor("borderColor")),t.\u0275\u0275classProp("checked",a.checked)("disabled",a.disabled)("loading",a.loading)("switch-large","large"===a.size)("switch-medium","medium"===a.size)("switch-small","small"===a.size),t.\u0275\u0275attribute("aria-checked",a.checked),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",a.checkedLabel||a.uncheckedLabel),t.\u0275\u0275advance(1),t.\u0275\u0275styleProp("background",a.getColor("switchColor")))},directives:[h.NgIf],encapsulation:2}),n})(),I=(()=>{class n{static forRoot(e){return{ngModule:n,providers:[{provide:m,useValue:e||{}}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=t.\u0275\u0275defineInjector({imports:[[h.CommonModule,E.u5],E.u5]}),n})()},5826:(L,P,r)=>{r.d(P,{l:()=>t,o:()=>E});var t=(()=>{return(h=t||(t={}))[h["D\xe9fauts mat\xe9riels"]=0]="D\xe9fauts mat\xe9riels",h[h.Telescopare=1]="Telescopare",h[h.Intenpaire=2]="Intenpaire",h[h["Cause inconnue"]=3]="Cause inconnue",t;var h})();const E=[{label:"Urgent < mois",value:"ELEVE",color:"danger"},{label:"Court terme < 1an",value:"FAIBLE",color:"warning"},{label:"Faible terme > 1an",value:"NORMAL",color:"success"},{label:"Autre",value:"OTHER",color:"info"}]},4038:(L,P,r)=>{r.d(P,{M:()=>R});var t=r(4762),E=r(1824),h=r(3405),C=r(4099),M=r(3596),m=r(2411),b=r(5686),f=r(5389),I=r(8735),n=r(1366),v=r(9204),e=r(2047),a=r(8053),T=r(5826),y=r(8260),g=r(3668),B=r(5633),O=r(6761),S=r(7777),l=r(4885),d=r(5565),u=r(4522),_=r(8274);const W=p=>""!==p?p.year+"-"+p.month+"-"+("0"+p.day).slice(-2):"";let R=(()=>{class p extends E.c8{constructor(s,o,i,c,D,U,A,K){super("anomalies",s),this.serviceElementsFactory=s,this.confirmDialogService=o,this.departmentService=i,this.communeService=c,this.edgeService=D,this.userService=U,this.http=A,this.toast=K,this.pageSize=y.N.pageSize,this.server=y.N.serverURL,this.severityOptions=T.o,this.departmentLoading=!1,this.departmentInput$=new h.xQ,this.usersLoading=!1,this.usersInput$=new h.xQ,this.edgesInRange$=new C.X([]),this.edgesLoading=!1,this.edgesInput$=new h.xQ,this.submitted=!1,this.statusLoading=0,this.page=1}findAll(){this.findByCriteria({page:1})}loadDepartments(s=!0){this.departments$=s?(0,M.z)((0,m.of)([]),this.departmentInput$.pipe((0,b.b)(500),(0,f.x)(),(0,I.h)(o=>null!=o),(0,n.b)(()=>this.departmentLoading=!0),(0,v.w)(o=>this.departmentService.getWithQuery("properties[]=id&properties[]=titre&titre="+o).pipe((0,e.K)(()=>(0,m.of)([])),(0,n.b)(()=>this.departmentLoading=!1))))):this.departmentService.getWithQuery("properties[]=id&properties[]=titre")}loadUsers(s=[]){this.users$=(0,M.z)((0,m.of)(s),this.usersInput$.pipe((0,b.b)(500),(0,f.x)(),(0,I.h)(o=>null!=o),(0,n.b)(()=>this.usersLoading=!0),(0,v.w)(o=>this.userService.getWithQuery("properties[]=id&properties[]=fullName&fullName="+o).pipe((0,e.K)(()=>(0,m.of)([])),(0,n.b)(()=>this.usersLoading=!1)))))}loadEdgesInRange(s,o){let i=Object.assign({},s);i["id[]"]=o,i["properties[]"]="id",i["properties[node_a][]"]="titre",i["properties[node_b][]"]="titre",delete i.node_a,i.node_b&&delete i.node_b,this.edgeService.getWithQuery(i).subscribe(c=>{this.edgesInRange$.next(c)})}loadEdgesByDepar(s){this.edge.reset(),this.edgesInRange$.next([]),this.edgeService.getWithQuery("properties[]=id&properties[]=node_a&properties[]=node_b&itemsPerPage=1000&department.id="+s.match(/\d+/)[0]).subscribe(o=>{this.edgesInRange$.next(o)})}getPagination(){this.pagination$=(0,m.of)(),this.pagination$=this.selectors$.entityActions$.pipe((0,a.U)(s=>s.payload.pagination))}deleteItem(s,o){this.confirmDialogService.setConfirmation("Vous \xeates s\xfbr de vouloir supprimer?",()=>{this.delete(s).pipe(this.toast.observe({loading:"Suppression...",success:()=>(o.closest("tr").remove(),"Anomaly supprim\xe9 avec succ\xe8s"),error:"un probl\xe8me est survenu, veuillez r\xe9essayer"})).subscribe()})}onSearch(){this.page=1,this.lastSearchedParams=this.anomalyForm.value,this.findByCriteria(Object.assign({page:1},this.lastSearchedParams))}onCreate(){let s=this.anomalyForm;if(this.submitted=!0,s.invalid)return;this.submitted=!1;let o=this.toast,i=Object.entries(s.value);const c=Object.fromEntries(i.filter(([D,U])=>""!==U));this.add(c).subscribe({error:()=>o.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){s.reset(),o.success("Anomaly ajout\xe9 avec succ\xe8s")}})}onUpdate(s){let o=this.anomalyForm;if(this.submitted=!0,o.invalid)return;this.submitted=!1;let i=this.toast,c=Object.entries(o.value);const D=Object.fromEntries(c.filter(([U,A])=>""!==A));D.id=s,this.update(D).subscribe({error:()=>i.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){i.success("Anomaly a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}updateStatus(s,o){s.stopPropagation();let i=this,D={id:o,status:!s.target.classList.contains("checked")};this.statusLoading=o,this.update(D).subscribe({error:()=>i.toast.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){i.statusLoading=0,i.toast.success("Statut a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}bulkCreate(s){return this.http.post(`${this.server}/api/anomalies/bulk?action=create`,{anomalies:s})}getRelatedAnomalies(s,o,i){s&&""!==s.trim()&&this.findByCriteria(Object.assign(Object.assign({page:1,"status[]":[!1,null]},{node_a:s.match(/\d+/)[0],depar:i.match(/\d+/)[0]}),o&&0!==o.length&&{node_b:o.map(c=>c.match(/\d+/)[0])}))}findByCriteria(s){return(0,t.mG)(this,void 0,void 0,function*(){if(this.anomalies$=(0,m.of)([]),Object.keys(s).length>1){const i=c=>s[c]&&delete Object.assign(s,{["createdAt["+c+"]"]:W(s[c])})[c];if(i("before"),i("after"),s.node_a){let c=yield this.edgeService.getEdgesInRange(s.depar,s.node_a,s.node_b?s.node_b:null).toPromise();this.loadEdgesInRange(s,c),s["edge.id[]"]=c,delete s.node_a,s.node_b&&delete s.node_b}}let o=Object.keys(s).filter(i=>""!=s[i]&&null!=s[i]).reduce((i,c)=>Object.assign(Object.assign({},i),{[c]:s[c]}),{});this.anomalies$=this.getWithQuery(o),this.getPagination()})}onPaginate(s){this.findByCriteria(Object.assign({page:s},this.lastSearchedParams))}getSeverity(s,o){const i=this.severityOptions.find(c=>c.value===s);return i?o?i.color:i.label:""}get department(){return this.anomalyForm.get("department")}get title(){return this.anomalyForm.get("title")}get edge(){return this.anomalyForm.get("edge")}}return p.\u0275fac=function(s){return new(s||p)(g.\u0275\u0275inject(E.yV),g.\u0275\u0275inject(B.D),g.\u0275\u0275inject(O.l),g.\u0275\u0275inject(S.s),g.\u0275\u0275inject(l.p),g.\u0275\u0275inject(d.K),g.\u0275\u0275inject(u.eN),g.\u0275\u0275inject(_.jE))},p.\u0275prov=g.\u0275\u0275defineInjectable({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()},5565:(L,P,r)=>{r.d(P,{K:()=>B});var t=r(1824),E=r(3405),h=r(3596),C=r(2411),M=r(5686),m=r(5389),b=r(8735),f=r(1366),I=r(9204),n=r(8053),v=r(2047),e=r(8260),a=r(3668),T=r(5633),y=r(4522),g=r(8274);let B=(()=>{class O extends t.c8{constructor(l,d,u,_){super("users",l),this.serviceElementsFactory=l,this.confirmDialogService=d,this.http=u,this.toast=_,this.pageSize=e.N.pageSize,this.server=e.N.serverURL,this.teamLoading=!1,this.teamInput$=new E.xQ,this.submitted=!1,this.page=1}findAll(){this.findByCriteria({page:1})}loadTeams(l=[]){this.teams$=(0,h.z)((0,C.of)(l),this.teamInput$.pipe((0,M.b)(500),(0,m.x)(),(0,b.h)(d=>null!=d),(0,f.b)(()=>this.teamLoading=!0),(0,I.w)(d=>this.http.get(`${this.server}/api/teams?properties[]=id&properties[]=titre&titre=`+d).pipe((0,n.U)(u=>u["hydra:member"]),(0,v.K)(()=>(0,C.of)([])),(0,f.b)(()=>this.teamLoading=!1)))))}getPagination(){this.pagination$=(0,C.of)(),this.pagination$=this.selectors$.entityActions$.pipe((0,n.U)(l=>l.payload.pagination))}deleteItem(l,d){this.confirmDialogService.setConfirmation("Vous \xeates s\xfbr de vouloir supprimer?",()=>{this.delete(l).pipe(this.toast.observe({loading:"Suppression...",success:()=>(d.closest("tr").remove(),"Utilisateur supprim\xe9 avec succ\xe8s"),error:"un probl\xe8me est survenu, veuillez r\xe9essayer"})).subscribe()})}onSearch(){this.page=1,this.lastSearchedParams=this.userForm.value,this.findByCriteria(Object.assign({page:1},this.lastSearchedParams))}onCreate(){let l=this.userForm;if(this.submitted=!0,l.invalid)return;this.submitted=!1;let d=this.toast,u=Object.entries(l.value);const _=Object.fromEntries(u.filter(([W,R])=>""!==R));_.roles=[_.roles.toString()],this.add(_).subscribe({error:()=>d.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){l.reset(),d.success("Utilisateur ajout\xe9 avec succ\xe8s")}})}onUpdate(l){let d=this.userForm;if(this.submitted=!0,d.invalid)return;this.submitted=!1;let u=this.toast,_=Object.assign({},d.value);_.id=l,_.roles=[_.roles.toString()],this.update(_).subscribe({error:()=>u.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){u.success("L'utilisateur a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}get fullName(){return this.userForm.get("fullName")}get username(){return this.userForm.get("username")}get password(){return this.userForm.get("password")}get roles(){return this.userForm.get("roles")}get team(){return this.userForm.get("team")}findByCriteria(l){this.users$=(0,C.of)([]);let d=Object.keys(l).filter(u=>""!=l[u]&&null!=l[u]).reduce((u,_)=>Object.assign(Object.assign({},u),{[_]:l[_]}),{});this.users$=this.getWithQuery(d),this.getPagination()}onPaginate(l){this.findByCriteria(Object.assign({page:l},this.lastSearchedParams))}}return O.\u0275fac=function(l){return new(l||O)(a.\u0275\u0275inject(t.yV),a.\u0275\u0275inject(T.D),a.\u0275\u0275inject(y.eN),a.\u0275\u0275inject(g.jE))},O.\u0275prov=a.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac,providedIn:"root"}),O})()}}]);