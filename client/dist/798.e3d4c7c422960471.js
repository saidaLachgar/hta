"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[798],{5630:(B,M,r)=>{r.d(M,{ob:()=>P,Su:()=>U});var s=r(3668),E=r(9133),h=r(6019);function O(l,v){if(1&l&&(s.\u0275\u0275elementStart(0,"label",2),s.\u0275\u0275elementStart(1,"span",3),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(3,"span",4),s.\u0275\u0275text(4),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementEnd()),2&l){const e=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275styleProp("color",e.getColor("checkedTextColor")),s.\u0275\u0275attribute("aria-label",e.checkedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate(e.checkedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275styleProp("color",e.getColor("uncheckedTextColor")),s.\u0275\u0275attribute("aria-label",e.uncheckedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate(e.uncheckedLabel)}}const I=["*"],g=new s.InjectionToken("UI_SWITCH_OPTIONS"),T={provide:E.JU,useExisting:(0,s.forwardRef)(()=>P),multi:!0};let P=(()=>{class l{constructor(e={},a){this.cdr=a,this.change=new s.EventEmitter,this.changeEvent=new s.EventEmitter,this.valueChange=new s.EventEmitter,this.onTouchedCallback=y=>{},this.onChangeCallback=y=>{},this.size=e&&e.size||"medium",this.color=e&&e.color,this.switchOffColor=e&&e.switchOffColor,this.switchColor=e&&e.switchColor,this.defaultBgColor=e&&e.defaultBgColor,this.defaultBoColor=e&&e.defaultBoColor,this.checkedLabel=e&&e.checkedLabel,this.uncheckedLabel=e&&e.uncheckedLabel,this.checkedTextColor=e&&e.checkedTextColor,this.uncheckedTextColor=e&&e.uncheckedTextColor}set checked(e){this._checked=!1!==e}get checked(){return this._checked}set disabled(e){this._disabled=!1!==e}get disabled(){return this._disabled}set reverse(e){this._reverse=!1!==e}get reverse(){return this._reverse}set loading(e){this._loading=!1!==e}get loading(){return this._loading}getColor(e=""){return"borderColor"===e?this.defaultBoColor:"switchColor"===e?this.reverse?this.checked&&this.switchOffColor||this.switchColor:this.checked?this.switchColor:this.switchOffColor||this.switchColor:"checkedTextColor"===e?this.reverse?this.uncheckedTextColor:this.checkedTextColor:"uncheckedTextColor"===e?this.reverse?this.checkedTextColor:this.uncheckedTextColor:this.reverse?this.checked?this.defaultBgColor:this.color:this.checked?this.color:this.defaultBgColor}onClick(e){this.disabled||(this.checked=!this.checked,this.change.emit(this.checked),this.valueChange.emit(this.checked),this.changeEvent.emit(e),this.onChangeCallback(this.checked),this.onTouchedCallback(this.checked),this.cdr.markForCheck())}onToggle(e){this.disabled||(this.beforeChange?this._beforeChange=this.beforeChange.subscribe(a=>{a&&this.onClick(e)}):this.onClick(e))}writeValue(e){e!==this.checked&&(this.checked=!!e),this.onChangeCallback(this.checked),this.cdr&&this.cdr.markForCheck()}registerOnChange(e){this.onChangeCallback=e}registerOnTouched(e){this.onTouchedCallback=e}setDisabledState(e){this.disabled=e}ngOnDestroy(){this._beforeChange&&this._beforeChange.unsubscribe()}}return l.\u0275fac=function(e){return new(e||l)(s.\u0275\u0275directiveInject(g,8),s.\u0275\u0275directiveInject(s.ChangeDetectorRef))},l.\u0275cmp=s.\u0275\u0275defineComponent({type:l,selectors:[["ui-switch"]],hostBindings:function(e,a){1&e&&s.\u0275\u0275listener("click",function(L){return a.onToggle(L)})},inputs:{size:"size",color:"color",switchOffColor:"switchOffColor",switchColor:"switchColor",defaultBgColor:"defaultBgColor",defaultBoColor:"defaultBoColor",checkedLabel:"checkedLabel",uncheckedLabel:"uncheckedLabel",checkedTextColor:"checkedTextColor",uncheckedTextColor:"uncheckedTextColor",checked:"checked",disabled:"disabled",reverse:"reverse",loading:"loading",beforeChange:"beforeChange"},outputs:{change:"change",changeEvent:"changeEvent",valueChange:"valueChange"},features:[s.\u0275\u0275ProvidersFeature([T])],ngContentSelectors:I,decls:4,vars:20,consts:[["type","button","role","switch",1,"switch"],["class","switch-pane",4,"ngIf"],[1,"switch-pane"],[1,"switch-label-checked"],[1,"switch-label-unchecked"]],template:function(e,a){1&e&&(s.\u0275\u0275projectionDef(),s.\u0275\u0275elementStart(0,"button",0),s.\u0275\u0275template(1,O,5,8,"label",1),s.\u0275\u0275elementStart(2,"small"),s.\u0275\u0275projection(3),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementEnd()),2&e&&(s.\u0275\u0275styleProp("background-color",a.getColor())("border-color",a.getColor("borderColor")),s.\u0275\u0275classProp("checked",a.checked)("disabled",a.disabled)("loading",a.loading)("switch-large","large"===a.size)("switch-medium","medium"===a.size)("switch-small","small"===a.size),s.\u0275\u0275attribute("aria-checked",a.checked),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",a.checkedLabel||a.uncheckedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275styleProp("background",a.getColor("switchColor")))},directives:[h.NgIf],encapsulation:2}),l})(),U=(()=>{class l{static forRoot(e){return{ngModule:l,providers:[{provide:g,useValue:e||{}}]}}}return l.\u0275fac=function(e){return new(e||l)},l.\u0275mod=s.\u0275\u0275defineNgModule({type:l}),l.\u0275inj=s.\u0275\u0275defineInjector({imports:[[h.CommonModule,E.u5],E.u5]}),l})()},5826:(B,M,r)=>{r.d(M,{l:()=>s,o:()=>E});var s=(()=>{return(h=s||(s={}))[h["D\xe9fauts mat\xe9riels"]=0]="D\xe9fauts mat\xe9riels",h[h.Telescopare=1]="Telescopare",h[h.Intenpaire=2]="Intenpaire",h[h["Cause inconnue"]=3]="Cause inconnue",s;var h})();const E=[{label:"Urgent < mois",value:"ELEVE",color:"danger"},{label:"Court terme < 1an",value:"FAIBLE",color:"warning"},{label:"Faible terme > 1an",value:"NORMAL",color:"success"},{label:"Autre",value:"OTHER",color:"info"}]},4038:(B,M,r)=>{r.d(M,{M:()=>f});var s=r(4762),E=r(1824),h=r(3405),O=r(4099),I=r(3596),g=r(2411),T=r(5686),P=r(5389),U=r(8735),l=r(1366),v=r(9204),e=r(2047),a=r(8053),y=r(5826),L=r(8260),p=r(3668),R=r(5633),A=r(6761),D=r(7777),j=r(4885),n=r(5565),d=r(4522),_=r(8274);const u=m=>""!==m?m.year+"-"+m.month+"-"+("0"+m.day).slice(-2):"";let f=(()=>{class m extends E.c8{constructor(t,o,i,c,b,S,W,K){super("anomalies",t),this.serviceElementsFactory=t,this.confirmDialogService=o,this.departmentService=i,this.communeService=c,this.edgeService=b,this.userService=S,this.http=W,this.toast=K,this.pageSize=L.N.pageSize,this.server=L.N.serverURL,this.severityOptions=y.o,this.departmentLoading=!1,this.departmentInput$=new h.xQ,this.usersLoading=!1,this.usersInput$=new h.xQ,this.edgesInRange$=new O.X([]),this.edgesLoading=!1,this.edgesInput$=new h.xQ,this.submitted=!1,this.statusLoading=0,this.page=1}findAll(){this.findByCriteria({page:1})}loadDepartments(t=!0){this.departments$=t?(0,I.z)((0,g.of)([]),this.departmentInput$.pipe((0,T.b)(500),(0,P.x)(),(0,U.h)(o=>null!=o),(0,l.b)(()=>this.departmentLoading=!0),(0,v.w)(o=>this.departmentService.getWithQuery("properties[]=id&properties[]=titre&titre="+o).pipe((0,e.K)(()=>(0,g.of)([])),(0,l.b)(()=>this.departmentLoading=!1))))):this.departmentService.getWithQuery("properties[]=id&properties[]=titre")}loadUsers(t=[]){this.users$=(0,I.z)((0,g.of)(t),this.usersInput$.pipe((0,T.b)(500),(0,P.x)(),(0,U.h)(o=>null!=o),(0,l.b)(()=>this.usersLoading=!0),(0,v.w)(o=>this.userService.getWithQuery("properties[]=id&properties[]=fullName&fullName="+o).pipe((0,e.K)(()=>(0,g.of)([])),(0,l.b)(()=>this.usersLoading=!1)))))}loadEdgesInRange(t,o){let i=Object.assign({},t);i["id[]"]=o,i["properties[]"]="id",i["properties[node_a][]"]="titre",i["properties[node_b][]"]="titre",delete i.node_a,i.node_b&&delete i.node_b,this.edgeService.getWithQuery(i).subscribe(c=>{this.edgesInRange$.next(c)})}loadEdgesByDepar(t){this.edge.reset(),this.edgesInRange$.next([]),this.edgeService.getWithQuery("properties[]=id&properties[]=node_a&properties[]=node_b&itemsPerPage=1000&department.id="+t.match(/\d+/)[0]).subscribe(o=>{this.edgesInRange$.next(o)})}getPagination(){this.pagination$=(0,g.of)(),this.pagination$=this.selectors$.entityActions$.pipe((0,a.U)(t=>t.payload.pagination))}deleteItem(t,o){this.confirmDialogService.setConfirmation("Vous \xeates s\xfbr de vouloir supprimer?",()=>{this.delete(t).pipe(this.toast.observe({loading:"Suppression...",success:()=>(o.closest("tr").remove(),"Anomaly supprim\xe9 avec succ\xe8s"),error:"un probl\xe8me est survenu, veuillez r\xe9essayer"})).subscribe()})}onSearch(){this.page=1,this.lastSearchedParams=this.anomalyForm.value,this.findByCriteria(Object.assign({page:1},this.lastSearchedParams))}onCreate(){let t=this.anomalyForm;if(this.submitted=!0,t.invalid)return;this.submitted=!1;let o=this.toast,i=Object.entries(t.value);const c=Object.fromEntries(i.filter(([b,S])=>""!==S));this.add(c).subscribe({error:()=>o.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){t.reset(),o.success("Anomaly ajout\xe9 avec succ\xe8s")}})}onUpdate(t){let o=this.anomalyForm;if(this.submitted=!0,o.invalid)return;this.submitted=!1;let i=this.toast,c=Object.entries(o.value);const b=Object.fromEntries(c.filter(([S,W])=>""!==W));b.id=t,this.update(b).subscribe({error:()=>i.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){i.success("Anomaly a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}updateStatus(t,o){t.stopPropagation();let i=this,b={id:o,status:!t.target.classList.contains("checked")};this.statusLoading=o,this.update(b).subscribe({error:()=>i.toast.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){i.statusLoading=0,i.toast.success("Statut a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}bulkCreate(t){return this.http.post(`${this.server}/api/anomalies/bulk?action=create`,{anomalies:t})}getRelatedAnomalies(t,o,i){t&&""!==t.trim()&&this.findByCriteria(Object.assign(Object.assign({page:1,"status[]":[!1,null]},{node_a:t.match(/\d+/)[0],depar:i.match(/\d+/)[0]}),o&&0!==o.length&&{node_b:o.map(c=>c.match(/\d+/)[0])}))}findByCriteria(t){return(0,s.mG)(this,void 0,void 0,function*(){if(this.anomalies$=(0,g.of)([]),Object.keys(t).length>1){const i=c=>t[c]&&delete Object.assign(t,{["createdAt["+c+"]"]:u(t[c])})[c];if(i("before"),i("after"),t.node_a){let c=yield this.edgeService.getEdgesInRange(t.depar,t.node_a,t.node_b?t.node_b:null).toPromise();this.loadEdgesInRange(t,c),t["edge.id[]"]=c,delete t.node_a,t.node_b&&delete t.node_b}}let o=Object.keys(t).filter(i=>""!=t[i]&&null!=t[i]).reduce((i,c)=>Object.assign(Object.assign({},i),{[c]:t[c]}),{});this.anomalies$=this.getWithQuery(o),this.getPagination()})}onPaginate(t){this.findByCriteria(Object.assign({page:t},this.lastSearchedParams))}getSeverity(t,o){const i=this.severityOptions.find(c=>c.value===t);return i?o?i.color:i.label:""}get department(){return this.anomalyForm.get("department")}get title(){return this.anomalyForm.get("title")}get edge(){return this.anomalyForm.get("edge")}}return m.\u0275fac=function(t){return new(t||m)(p.\u0275\u0275inject(E.yV),p.\u0275\u0275inject(R.D),p.\u0275\u0275inject(A.l),p.\u0275\u0275inject(D.s),p.\u0275\u0275inject(j.p),p.\u0275\u0275inject(n.K),p.\u0275\u0275inject(d.eN),p.\u0275\u0275inject(_.jE))},m.\u0275prov=p.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},5565:(B,M,r)=>{r.d(M,{K:()=>A});var s=r(1824),E=r(3405),h=r(3596),O=r(2411),I=r(5686),g=r(5389),T=r(8735),P=r(1366),U=r(9204),l=r(8053),v=r(2047),e=r(8260),a=r(3668),y=r(5633),L=r(4522),p=r(7686),R=r(8274);let A=(()=>{class D extends s.c8{constructor(n,d,_,u,f){super("users",n),this.serviceElementsFactory=n,this.confirmDialogService=d,this.http=_,this.authService=u,this.toast=f,this.pageSize=e.N.pageSize,this.server=e.N.serverURL,this.teamLoading=!1,this.teamInput$=new E.xQ,this.submitted=!1,this.loading=!1,this.page=1}findAll(){this.findByCriteria({page:1})}loadTeams(n=[]){this.teams$=(0,h.z)((0,O.of)(n),this.teamInput$.pipe((0,I.b)(500),(0,g.x)(),(0,T.h)(d=>null!=d),(0,P.b)(()=>this.teamLoading=!0),(0,U.w)(d=>this.http.get(`${this.server}/api/teams?properties[]=id&properties[]=titre&titre=`+d).pipe((0,l.U)(_=>_["hydra:member"]),(0,v.K)(()=>(0,O.of)([])),(0,P.b)(()=>this.teamLoading=!1)))))}getPagination(){this.pagination$=(0,O.of)(),this.pagination$=this.selectors$.entityActions$.pipe((0,l.U)(n=>n.payload.pagination))}deleteItem(n,d){this.confirmDialogService.setConfirmation("Vous \xeates s\xfbr de vouloir supprimer?",()=>{this.delete(n).pipe(this.toast.observe({loading:"Suppression...",success:()=>(d.closest("tr").remove(),"Utilisateur supprim\xe9 avec succ\xe8s"),error:"un probl\xe8me est survenu, veuillez r\xe9essayer"})).subscribe()})}onSearch(){this.page=1,this.lastSearchedParams=this.userForm.value,this.findByCriteria(Object.assign({page:1},this.lastSearchedParams))}onCreate(){let n=this.userForm;if(this.submitted=!0,n.invalid)return;this.submitted=!1;let d=this.toast,_=Object.entries(n.value);const u=Object.fromEntries(_.filter(([f,m])=>""!==m));u.roles=[u.roles.toString()],this.add(u).subscribe({error:()=>d.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){n.reset(),d.success("Utilisateur ajout\xe9 avec succ\xe8s")}})}onUpdate(n,d=!1){let _=this.userForm;if(this.submitted=!0,_.invalid)return;this.submitted=!1;let u=this,f=this.toast,m=this.authService.user,C=Object.assign({},_.value);C.id=n,d?C=Object.entries(C).reduce((t,[o,i])=>(""!==i&&null!==i&&(t[o]=i),t),{}):C.roles=[C.roles.toString()],this.update(C).subscribe({error:()=>f.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){m.id==n?(u.loading=!0,u.authService.logout(!1),u.authService.login(C.username,C.password).subscribe({error:t=>{t&&f.error(t.error.message),u.loading=!1},complete(){u.loading=!1,f.success("L'utilisateur a \xe9t\xe9 mis \xe0 jour avec succ\xe8s"),setTimeout(()=>window.location.reload(),10)}})):f.success("L'utilisateur a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}get fullName(){return this.userForm.get("fullName")}get username(){return this.userForm.get("username")}get password(){return this.userForm.get("password")}get roles(){return this.userForm.get("roles")}get team(){return this.userForm.get("team")}findByCriteria(n){this.users$=(0,O.of)([]);let d=Object.keys(n).filter(_=>""!=n[_]&&null!=n[_]).reduce((_,u)=>Object.assign(Object.assign({},_),{[u]:n[u]}),{});this.users$=this.getWithQuery(d),this.getPagination()}onPaginate(n){this.findByCriteria(Object.assign({page:n},this.lastSearchedParams))}}return D.\u0275fac=function(n){return new(n||D)(a.\u0275\u0275inject(s.yV),a.\u0275\u0275inject(y.D),a.\u0275\u0275inject(L.eN),a.\u0275\u0275inject(p.$),a.\u0275\u0275inject(R.jE))},D.\u0275prov=a.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac,providedIn:"root"}),D})()}}]);