"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[859],{9859:(nt,B,o)=>{o.r(B),o.d(B,{visiteModule:()=>tt});var h=o(7317),E=o(9167),e=o(3668),J=o(4762),D=o(1824),b=o(3405),x=o(3596),u=o(2411),y=o(5686),C=o(5389),I=o(8735),g=o(1366),L=o(9204),F=o(8053),T=o(2047),w=o(8260),U=o(5633),G=o(6761),W=o(4038),K=o(7777),Y=o(2360),Z=o(8274),H=o(4522);const k=(n,r=2)=>String(n).padStart(r,"0"),X=(n,r)=>new Date(n.year,n.month-1,n.day,r.hour,r.minute,r.second).toISOString(),q=n=>""!==n?`${n.year}-${k(n.month)}-${k(n.day)}`:"";let A=(()=>{class n extends D.c8{constructor(t,i,a,s,d,l,f,v,S){super("visites",t),this.serviceElementsFactory=t,this.confirmDialogService=i,this.departmentService=a,this.anomalyService=s,this.communeService=d,this.nodeService=l,this.toast=f,this.http=v,this.router=S,this.pageSize=w.N.pageSize,this.server=w.N.serverURL,this.existingVisit=!1,this.EditeMode=!1,this.ANodeLoading=!1,this.ANodeInput$=new b.xQ,this.BNodeLoading=!1,this.BNodeInput$=new b.xQ,this.departmentLoading=!1,this.departmentInput$=new b.xQ,this.teamLoading=!1,this.teamInput$=new b.xQ,this.submitted=!1,this.page=1,this.anomalyLoading=!1}findAll(){this.findByCriteria({page:1})}loadTeams(t=[]){this.teams$=(0,x.z)((0,u.of)(t),this.teamInput$.pipe((0,y.b)(500),(0,C.x)(),(0,I.h)(i=>null!=i),(0,g.b)(()=>this.teamLoading=!0),(0,L.w)(i=>this.http.get(`${this.server}/api/teams?properties[]=id&properties[]=titre&titre=`+i).pipe((0,F.U)(a=>a["hydra:member"]),(0,T.K)(()=>(0,u.of)([])),(0,g.b)(()=>this.teamLoading=!1)))))}loadDepartments(t=!0){this.departments$=t?(0,x.z)((0,u.of)([]),this.departmentInput$.pipe((0,y.b)(500),(0,C.x)(),(0,I.h)(i=>null!=i),(0,g.b)(()=>this.departmentLoading=!0),(0,L.w)(i=>this.departmentService.getWithQuery("properties[]=id&properties[]=titre&titre="+i).pipe((0,T.K)(()=>(0,u.of)([])),(0,g.b)(()=>this.departmentLoading=!1))))):this.departmentService.getWithQuery("properties[]=id&properties[]=titre")}loadANodes(t=[]){this.ANode$=(0,x.z)((0,u.of)(t),this.ANodeInput$.pipe((0,y.b)(500),(0,C.x)(),(0,I.h)(i=>null!=i),(0,g.b)(()=>this.ANodeLoading=!0),(0,L.w)(i=>this.nodeService.getWithQuery("properties[]=id&properties[]=titre&titre="+i+(this.department?"&department.id="+this.department.value.match(/\d+/)[0]:"")+(this.departments?"&properties[department][]=titre&"+this.departments.map(a=>`department.id[]=${a}`).join("&"):"")).pipe((0,T.K)(()=>(0,u.of)([])),(0,g.b)(()=>this.ANodeLoading=!1)))))}loadBNodes(t=[]){this.BNode$=(0,x.z)((0,u.of)(t),this.BNodeInput$.pipe((0,y.b)(500),(0,C.x)(),(0,I.h)(i=>null!=i),(0,g.b)(()=>this.BNodeLoading=!0),(0,L.w)(i=>this.nodeService.getWithQuery("properties[]=id&properties[]=titre&titre="+i+(this.department?"&department.id="+this.department.value.match(/\d+/)[0]:"")+(this.departments?"&properties[department][]=titre&"+this.departments.map(a=>`department.id[]=${a}`).join("&"):"")).pipe((0,T.K)(()=>(0,u.of)([])),(0,g.b)(()=>this.BNodeLoading=!1)))))}getPagination(){this.pagination$=(0,u.of)(),this.pagination$=this.selectors$.entityActions$.pipe((0,F.U)(t=>t.payload.pagination))}deleteItem(t=null,i=null){this.confirmDialogService.setConfirmation("Vous \xeates s\xfbr de vouloir supprimer?",()=>{this.delete(t||this.existingVisit.id).pipe(this.toast.observe({loading:"Suppression...",success:()=>(i?i.closest("tr").remove():this.router.navigate(["/visites"]),"supprim\xe9 avec succ\xe8s"),error:"un probl\xe8me est survenu, veuillez r\xe9essayer"})).subscribe()})}onSearch(){this.page=1,this.lastSearchedParams=this.visiteForm.value,this.findByCriteria(Object.assign({page:1},this.lastSearchedParams))}Persist(t){return(0,J.mG)(this,void 0,void 0,function*(){if(this.submitted=!0,this.visiteForm.invalid)return;this.submitted=!1;let i=null;this.EditeMode?i=this.existingVisit?this.existingVisit.id:null:this.EditeMode="EDIT"==t;let a=this.visiteForm.value,s=this,d=this.toast,l={date:a.date?X(a.date,a.time):null,team:a.team?a.team:null,nbSupport:a.nbSupport?a.nbSupport:0,department:a.department?a.department:null,nodeA:a.nodeA?a.nodeA:null,nodeB:a.nodeB&&a.nodeB.length?a.nodeB:[]},f=a.anomalies;this.anomalyLoading=!0,f.length&&(yield this.anomalyService.bulkCreate(f).toPromise()),this.anomalyLoading=!1,i?(l.id=i,this.update(l).subscribe({error:()=>d.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){d.success("L'interuption a \xe9t\xe9 sauvegard\xe9e avec succ\xe8s "),"LIST"==t&&s.router.navigate(["/visites"]),s.submitted=!1}})):this.add(l).pipe((0,g.b)(S=>this.existingVisit=S)).subscribe({error:()=>d.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){d.success("L'interuption ajout\xe9e avec succ\xe8s"),"NEW"==t&&location.reload(),"LIST"==t&&s.router.navigate(["/visites"]),s.submitted=!1}});let v=this.visiteForm.get("anomalies");for(;0!==v.length;)v.removeAt(0);this.anomalyService.getRelatedAnomalies(a.nodeA,a.nodeB,a.department)})}findByCriteria(t){if(this.visites$=(0,u.of)([]),Object.keys(t).length>1){const a=s=>t[s]&&delete Object.assign(t,{["date["+s+"]"]:q(t[s])})[s];a("before"),a("after")}let i=Object.keys(t).filter(a=>""!=t[a]&&null!=t[a]).reduce((a,s)=>Object.assign(Object.assign({},a),{[s]:t[s]}),{});this.visites$=this.getWithQuery(i),this.getPagination()}onPaginate(t){this.findByCriteria(Object.assign({page:t},this.lastSearchedParams))}get departments(){let t=this.visiteForm.controls["node_a.department.id[]"];return t?t.value:null}get designation(){return this.visiteForm.get("designation")}get department(){return this.visiteForm.get("department")}get BNode(){return this.visiteForm.get("nodeB")}get ANode(){return this.visiteForm.get("nodeA")}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275inject(D.yV),e.\u0275\u0275inject(U.D),e.\u0275\u0275inject(G.l),e.\u0275\u0275inject(W.M),e.\u0275\u0275inject(K.s),e.\u0275\u0275inject(Y.B),e.\u0275\u0275inject(Z.jE),e.\u0275\u0275inject(H.eN),e.\u0275\u0275inject(h.F0))},n.\u0275prov=e.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var N=o(7686),$=o(1950),c=o(6019),z=o(2008);const ee=function(n){return["/departments/details",n]};function te(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"a",15),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("routerLink",t.authService.isAuthorized("departments_details")?e.\u0275\u0275pureFunction1(2,ee,t.visite.node_a.department.id):null),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.visite.node_a.department.titre)}}const V=function(n){return["/nodes/details",n]};function ne(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"a",15),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("routerLink",t.authService.isAuthorized("nodes_details")?e.\u0275\u0275pureFunction1(2,V,t.visite.node_a.id):null),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.visite.node_a.titre)}}function ie(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275elementStart(1,"a",15),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&n){const t=r.$implicit,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("routerLink",i.authService.isAuthorized("nodes_details")?e.\u0275\u0275pureFunction1(2,V,t.id):null),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("- ",t.titre,"")}}const ae=function(n){return["/teams/details",n]};function re(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"a",15),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("routerLink",t.authService.isAuthorized("teams_details")?e.\u0275\u0275pureFunction1(2,ae,t.visite.team.id):null),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.visite.team.titre)}}function se(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"table",10),e.\u0275\u0275elementStart(1,"tbody"),e.\u0275\u0275elementStart(2,"tr"),e.\u0275\u0275elementStart(3,"th",11),e.\u0275\u0275text(4,"Date :"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"td"),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"date"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"tr"),e.\u0275\u0275elementStart(9,"th",11),e.\u0275\u0275text(10,"D\xe9part :"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"td"),e.\u0275\u0275template(12,te,2,4,"a",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"tr"),e.\u0275\u0275elementStart(14,"th",11),e.\u0275\u0275text(15,"De :"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"td"),e.\u0275\u0275template(17,ne,2,4,"a",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"tr"),e.\u0275\u0275elementStart(19,"th",11),e.\u0275\u0275text(20,"\xc0 :"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"td"),e.\u0275\u0275template(22,ie,3,4,"div",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"tr"),e.\u0275\u0275elementStart(24,"th",11),e.\u0275\u0275text(25,"Longueur visit\xe9e :"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"td"),e.\u0275\u0275elementStart(27,"b"),e.\u0275\u0275text(28),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"small",14),e.\u0275\u0275text(30),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(31,"tr"),e.\u0275\u0275elementStart(32,"th",11),e.\u0275\u0275text(33,"\xc9quipe :"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(34,"td"),e.\u0275\u0275template(35,re,2,4,"a",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind3(7,8,t.visite.date,"medium","Africa/Casablanca")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",t.visite.node_a.department),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",t.visite.node_a),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",t.visite.node_b),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.visite.nbSupport),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2("(",100*t.visite.nbSupport,"/",t.visite.edge_set_length,"km)"),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",t.visite.team)}}let oe=(()=>{class n{constructor(t,i,a){this.route=t,this.service=i,this.authService=a;let s=t.snapshot.paramMap.get("id");i.getByKey(s).subscribe(d=>{this.visite=d,this.currentEdge={ANode:d.node_a["@id"],BNode:d.node_b["@id"],department:d.node_a.department["@id"],type:"false"}})}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(A),e.\u0275\u0275directiveInject(N.$))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["app-visite-details"]],decls:12,vars:6,consts:[[1,"container-fluid"],["title","D\xe9tail de l'interruption",3,"Loading","breadcrumbItems"],[1,"row"],[1,"card","mt-4"],[1,"card-body","pt-5"],[1,"table-responsive"],["class","table table-nowrap mb-0",4,"ngIf"],["routerLink","/visite",1,"btn","btn-light","mt-4","float-end"],[1,"fas","fa-arrow-circle-left","me-1"],[3,"currentEdge"],[1,"table","table-nowrap","mb-0"],["scope","row"],["target","_blank",3,"routerLink",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"text-muted"],["target","_blank",3,"routerLink"]],template:function(t,i){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"app-page-title",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",2),e.\u0275\u0275elementStart(4,"div",3),e.\u0275\u0275elementStart(5,"div",4),e.\u0275\u0275elementStart(6,"div",5),e.\u0275\u0275template(7,se,36,12,"table",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"button",7),e.\u0275\u0275element(9,"i",8),e.\u0275\u0275text(10,"Retour \xe0 la liste"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"app-related-anomalies",9),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("Loading",e.\u0275\u0275pipeBind1(2,4,i.service.loading$))("breadcrumbItems",i.breadCrumbItems),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.visite),e.\u0275\u0275advance(4),e.\u0275\u0275property("currentEdge",i.currentEdge))},directives:[$.V,c.NgIf,h.rH,z.T,c.NgForOf,h.yS],pipes:[c.AsyncPipe,c.DatePipe],encapsulation:2}),n})();var m=o(9133),_=o(9785),P=o(5396),p=o(6015);function le(n,r){1&n&&(e.\u0275\u0275elementStart(0,"a",62),e.\u0275\u0275element(1,"i",63),e.\u0275\u0275text(2," Ajouter"),e.\u0275\u0275elementEnd())}function de(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext().item;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" - ",t.department.titre,"")}}function me(n,r){if(1&n&&(e.\u0275\u0275text(0),e.\u0275\u0275template(1,de,2,1,"span",61)),2&n){const t=r.item,i=e.\u0275\u0275nextContext();e.\u0275\u0275textInterpolate1(" ",t.titre,""),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.service.departments&&i.service.departments.length>1)}}function pe(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext().item;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" - ",t.department.titre,"")}}function ce(n,r){if(1&n&&(e.\u0275\u0275text(0),e.\u0275\u0275template(1,pe,2,1,"span",61)),2&n){const t=r.item,i=e.\u0275\u0275nextContext();e.\u0275\u0275textInterpolate1(" ",t.titre,""),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.service.departments&&i.service.departments.length>1)}}function ue(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext().item;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" - ",t.department.titre,"")}}function ve(n,r){if(1&n&&(e.\u0275\u0275text(0),e.\u0275\u0275template(1,ue,2,1,"span",61)),2&n){const t=r.item,i=e.\u0275\u0275nextContext();e.\u0275\u0275textInterpolate1(" ",t.titre,""),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.service.departments&&i.service.departments.length>1)}}function ge(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext().item;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" - ",t.department.titre,"")}}function fe(n,r){if(1&n&&(e.\u0275\u0275text(0),e.\u0275\u0275template(1,ge,2,1,"span",61)),2&n){const t=r.item,i=e.\u0275\u0275nextContext();e.\u0275\u0275textInterpolate1(" ",t.titre,""),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.service.departments&&i.service.departments.length>1)}}function he(n,r){1&n&&(e.\u0275\u0275elementStart(0,"td",64),e.\u0275\u0275text(1," Chargement... "),e.\u0275\u0275elementEnd())}function _e(n,r){1&n&&(e.\u0275\u0275elementStart(0,"td",64),e.\u0275\u0275text(1," Aucune donn\xe9e trouv\xe9e ! "),e.\u0275\u0275elementEnd())}const Se=function(n){return["/departments/details",n]};function Ee(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"a",73),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext();e.\u0275\u0275property("routerLink",i.authService.isAuthorized("departments_details")?e.\u0275\u0275pureFunction1(2,Se,t.node_a.department.id):null),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.node_a.department.titre)}}const O=function(n){return["/nodes/details",n]};function be(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"a",73),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext();e.\u0275\u0275property("routerLink",i.authService.isAuthorized("nodes_details")?e.\u0275\u0275pureFunction1(2,O,t.node_a.id):null),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.node_a.titre)}}function xe(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275elementStart(1,"a",73),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&n){const t=r.$implicit,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("routerLink",i.authService.isAuthorized("nodes_details")?e.\u0275\u0275pureFunction1(2,O,t.id):null),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("- ",t.titre,"")}}const ye=function(n){return["/teams/details",n]};function Ce(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"a",73),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext();e.\u0275\u0275property("routerLink",i.authService.isAuthorized("teams_details")?e.\u0275\u0275pureFunction1(2,ye,t.team.id):null),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.team.titre)}}function Ie(n,r){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",74),e.\u0275\u0275element(2,"i",75),e.\u0275\u0275elementStart(3,"span",76),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&n){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate2("",t.undone_anomalies,"/",t.total_anomalies," Anomalies")}}function Le(n,r){1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",78),e.\u0275\u0275element(2,"i",79),e.\u0275\u0275elementStart(3,"span",76),e.\u0275\u0275text(4,"Pas d'anomalies"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd())}function Te(n,r){1&n&&(e.\u0275\u0275elementStart(0,"div",80),e.\u0275\u0275element(1,"i",81),e.\u0275\u0275elementStart(2,"span",76),e.\u0275\u0275text(3,"Toutes r\xe9solues"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd())}function Ae(n,r){if(1&n&&(e.\u0275\u0275template(0,Le,5,0,"ng-container",69),e.\u0275\u0275template(1,Te,4,0,"ng-template",null,77,e.\u0275\u0275templateRefExtractor)),2&n){const t=e.\u0275\u0275reference(2),i=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("ngIf",0==i.total_anomalies)("ngIfElse",t)}}const M=function(n){return["details",n]};function Ne(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"a",87),e.\u0275\u0275element(1,"i",88),e.\u0275\u0275text(2," Voir "),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2).$implicit;e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(1,M,t.id))}}const $e=function(n){return["persist",n]};function Be(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"a",87),e.\u0275\u0275element(1,"i",89),e.\u0275\u0275text(2," Modifier "),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2).$implicit;e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(1,$e,t.id))}}function De(n,r){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"a",90),e.\u0275\u0275listener("click",function(a){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext(2).$implicit;return e.\u0275\u0275nextContext().service.deleteItem(s.id,a.target)}),e.\u0275\u0275element(1,"i",91),e.\u0275\u0275text(2," Supprimer "),e.\u0275\u0275elementEnd()}}function Fe(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"div",82),e.\u0275\u0275element(1,"i",83),e.\u0275\u0275elementStart(2,"div",84),e.\u0275\u0275template(3,Ne,3,3,"a",85),e.\u0275\u0275template(4,Be,3,3,"a",85),e.\u0275\u0275template(5,De,3,0,"a",86),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.authService.isAuthorized("visites_details")),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.authService.isAuthorized("visites_update")),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.authService.isAuthorized("visites_delete"))}}const we=function(){return[]};function ke(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"tr",36),e.\u0275\u0275elementStart(1,"td"),e.\u0275\u0275element(2,"ngb-highlight",65),e.\u0275\u0275pipe(3,"date"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"td"),e.\u0275\u0275template(5,Ee,2,4,"a",66),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"td"),e.\u0275\u0275template(7,be,2,4,"a",66),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"td"),e.\u0275\u0275template(9,xe,3,4,"div",67),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"td"),e.\u0275\u0275elementStart(11,"b"),e.\u0275\u0275element(12,"ngb-highlight",65),e.\u0275\u0275text(13," Support"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(14,"br"),e.\u0275\u0275elementStart(15,"small",8),e.\u0275\u0275text(16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"td"),e.\u0275\u0275template(18,Ce,2,4,"a",66),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"td"),e.\u0275\u0275elementStart(20,"a",68),e.\u0275\u0275template(21,Ie,5,2,"ng-container",69),e.\u0275\u0275template(22,Ae,3,2,"ng-template",null,70,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"td",71),e.\u0275\u0275template(25,Fe,6,3,"div",72),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&n){const t=r.$implicit,i=e.\u0275\u0275reference(23),a=e.\u0275\u0275nextContext(),s=e.\u0275\u0275reference(88),d=e.\u0275\u0275reference(92),l=e.\u0275\u0275reference(112);e.\u0275\u0275advance(2),e.\u0275\u0275property("result",e.\u0275\u0275pipeBind3(3,14,t.date,"medium","Africa/Casablanca"))("term",s.value+d.value),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.node_a.department),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t.node_a),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.node_b),e.\u0275\u0275advance(3),e.\u0275\u0275property("result",t.nbSupport)("term",l.value),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate2("(",100*t.nbSupport,"/",t.edge_set_length,"km)"),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t.team),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",a.authService.isAuthorized("visites_details")?e.\u0275\u0275pureFunction1(18,M,t.id):e.\u0275\u0275pureFunction0(20,we)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.undone_anomalies>0&&t.undone_anomalies!=t.total_anomalies)("ngIfElse",i),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",a.authService.isAuthorized("visites_details")||a.authService.isAuthorized("visites_update")||a.authService.isAuthorized("visites_delete"))}}function ze(n,r){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",93),e.\u0275\u0275elementStart(1,"div",94),e.\u0275\u0275elementStart(2,"div",95),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",94),e.\u0275\u0275elementStart(5,"div",96),e.\u0275\u0275elementStart(6,"ngb-pagination",97),e.\u0275\u0275listener("pageChange",function(a){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).service.page=a})("pageChange",function(a){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).service.onPaginate(a)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext().ngIf,i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate3(" Affichage de ",t.startIndex," \xe0 ",t.endIndex," de ",t.totalRecords," entr\xe9es "),e.\u0275\u0275advance(3),e.\u0275\u0275property("collectionSize",t.totalRecords)("page",i.service.page)("pageSize",i.service.pageSize)("maxSize",5)}}function Ve(n,r){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ze,7,7,"div",92),e.\u0275\u0275elementContainerEnd()),2&n){const t=r.ngIf,i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.totalRecords>i.service.pageSize)}}let Pe=(()=>{class n{constructor(t,i,a,s){this.service=t,this.fb=i,this.authService=a,this.config=s,t.findAll(),t.loadTeams(),t.loadANodes(),t.loadBNodes(),t.loadDepartments(),t.visiteForm=i.group({nbSupport:[null],before:[""],after:[""],"node_a.department.id[]":[""],"node_a.id[]":[""],"node_b.id[]":[""],"team.id[]":[""]}),s.notFoundText="Aucune donn\xe9e trouv\xe9e !",this.Chartdata={chart:{height:220,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{horizontal:!0}},dataLabels:{enabled:!1},series:[{data:[380,430,450,475,550,584]}],colors:["#269ffb"],xaxis:{categories:["LAMZOUDIA","Chichaoua","SIDI BOUZID","Saidate","SIDI MED DALIL","Ahdil"]},grid:{borderColor:"#f1f1f1"}}}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275directiveInject(A),e.\u0275\u0275directiveInject(m.qu),e.\u0275\u0275directiveInject(N.$),e.\u0275\u0275directiveInject(_.$q))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["app-visites-list"]],decls:137,vars:58,consts:[[1,"container-fluid","mb-5"],[1,"row"],[1,"col-6","d-flex","flex-column"],[1,"card","card-body","py-2","flex-grow-0"],[1,"col-7","p-1"],[1,"border","p-3","rounded-3"],[1,"fw-medium","mb-1"],[1,"col-6"],[1,"text-muted"],[1,"h2","d-block"],[1,"col-5","p-1"],[1,"fw-medium","mb-2"],[1,"mt-2","mb-2"],[1,"badge","badge-soft-success","font-size-11","me-2"],[1,"mdi","mdi-arrow-up"],[1,"h2","mb-0"],[1,"card","card-body","flex-1"],[1,"py-2"],[1,"float-end"],[1,"progress","animated-progess","progress-sm"],["role","progressbar","aria-valuenow","78","aria-valuemin","0","aria-valuemax","100",1,"progress-bar",2,"width","78%"],[1,"card","card-body","pb-0"],[1,"fw-medium","mb-0"],["dir","ltr",1,"apex-charts",3,"series","chart","plotOptions","dataLabels","xaxis","colors","grid"],[1,"row","align-items-center","justify-content-between","mb-4"],[1,"col-auto"],["title","Liste des visites",3,"breadcrumbItems"],["routerLink","/visites/persist","class","btn btn-primary ms-2",4,"ngIf"],[1,"col-12"],[1,"card"],[1,"card-body"],[1,"table-responsive",3,"formGroup","ngSubmit"],[1,"table","table-bordered"],[2,"min-width","200px"],[2,"min-width","130px"],["width","123px"],["valign","middle"],[1,"d-flex","gap-2"],[1,"input-group","clockpicker"],["ngbDatepicker","","formControlName","after","placeholder","De...",1,"form-control",3,"click"],["searchDateStart","","ds","ngbDatepicker"],["ngbDatepicker","","formControlName","before","placeholder","\xc0...",1,"form-control",3,"click"],["searchDateEnd","","de","ngbDatepicker"],["formControlName","node_a.department.id[]","bindLabel","titre","bindValue","id","placeholder","D\xe9part..","typeToSearchText","Veuillez saisir 2 caract\xe8res ou plus",3,"items","multiple","minTermLength","loading","typeahead"],["searchDepar",""],["formControlName","node_a.id[]","bindValue","id","placeholder","De..","typeToSearchText","Veuillez saisir 2 caract\xe8res ou plus",3,"items","multiple","minTermLength","readonly","loading","typeahead"],["searchANode",""],["ng-label-tmp",""],["ng-option-tmp",""],["formControlName","node_b.id[]","bindValue","id","placeholder","\xc0..","typeToSearchText","Veuillez saisir 2 caract\xe8res ou plus",3,"items","multiple","minTermLength","readonly","loading","typeahead"],["searchBNode",""],["type","text","placeholder","Longueur visit\xe9e...","formControlName","nbSupport",1,"form-control"],["searchNbSupport",""],["formControlName","team.id[]","bindLabel","titre","bindValue","id","placeholder","\xc9quipe..","typeToSearchText","Veuillez saisir 2 caract\xe8res ou plus",3,"items","multiple","minTermLength","loading","typeahead"],["searchTeam",""],["type","submit",1,"btn","btn-sm","btn-primary","d-flex","align-items-center"],[1,"bx","bx-search","me-1"],["type","reset",1,"btn","btn-sm","text-primary","flex","align-items-center",3,"click"],[1,"bx","bx-x","me-1"],["class","text-center","colspan","8",4,"ngIf"],["valign","middle",4,"ngFor","ngForOf"],[4,"ngIf"],["routerLink","/visites/persist",1,"btn","btn-primary","ms-2"],[1,"fas","fa-plus-circle"],["colspan","8",1,"text-center"],[3,"result","term"],["target","_blank",3,"routerLink",4,"ngIf"],[4,"ngFor","ngForOf"],["href","javascript: void(0);","fragment","anomalies-list",3,"routerLink"],[4,"ngIf","ngIfElse"],["NoAnomalies",""],["align","center"],["ngbDropdown","","placement","bottom-left",4,"ngIf"],["target","_blank",3,"routerLink"],[1,"badge","badge-soft-danger","c-pointer","rounded-pill","border-danger","border","px-3","py-2","font-size-13","w-100"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"text-body"],["AllResolved",""],[1,"badge","badge-soft-info","c-pointer","rounded-pill","border-info","border","px-3","py-2","font-size-13","w-100"],[1,"fas","fa-info-circle","me-2"],[1,"badge","badge-soft-success","c-pointer","rounded-pill","border-success","border","px-3","py-2","font-size-13","w-100"],[1,"fas","fa-check-circle","me-2"],["ngbDropdown","","placement","bottom-left"],["ngbDropdownToggle","","data-toggle","dropdown","aria-expanded","true",1,"fas","fa-ellipsis-h","dropdown-toggle","c-pointer"],["ngbDropdownMenu","",1,"dropdown-menu","dropdown-menu-end"],["class","dropdown-item","href","javascript: void(0);",3,"routerLink",4,"ngIf"],["class","dropdown-item text-danger","href","javascript: void(0);",3,"click",4,"ngIf"],["href","javascript: void(0);",1,"dropdown-item",3,"routerLink"],[1,"fas","fa-eye","me-2"],[1,"fas","fa-edit","me-2"],["href","javascript: void(0);",1,"dropdown-item","text-danger",3,"click"],[1,"fas","fa-trash","me-2"],["class","row justify-content-md-between align-items-md-center mt-2",4,"ngIf"],[1,"row","justify-content-md-between","align-items-md-center","mt-2"],[1,"col-sm-12","col-md-5"],["id","tickets-table_info","role","status","aria-live","polite",1,"dataTables_info","mb-2"],[1,"text-md-right","float-md-end","pagination-rounded"],[3,"collectionSize","page","pageSize","maxSize","pageChange"]],template:function(t,i){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275elementStart(1,"div",1),e.\u0275\u0275elementStart(2,"div",2),e.\u0275\u0275elementStart(3,"div",3),e.\u0275\u0275elementStart(4,"div",1),e.\u0275\u0275elementStart(5,"div",4),e.\u0275\u0275elementStart(6,"div",5),e.\u0275\u0275elementStart(7,"p",6),e.\u0275\u0275text(8,"Distance parcourue"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div",1),e.\u0275\u0275elementStart(10,"div",7),e.\u0275\u0275elementStart(11,"small",8),e.\u0275\u0275text(12,"Ann\xe9e courante"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"strong",9),e.\u0275\u0275text(14,"1800 "),e.\u0275\u0275elementStart(15,"small",8),e.\u0275\u0275text(16,"/12000 km"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"div",7),e.\u0275\u0275elementStart(18,"small",8),e.\u0275\u0275text(19,"Mois en cours"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"strong",9),e.\u0275\u0275text(21,"800 km"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(22,"div",10),e.\u0275\u0275elementStart(23,"div",5),e.\u0275\u0275elementStart(24,"p",11),e.\u0275\u0275text(25,"Anomalies "),e.\u0275\u0275elementStart(26,"small",8),e.\u0275\u0275text(27,"(mois en cours)"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"p",12),e.\u0275\u0275elementStart(29,"span",13),e.\u0275\u0275text(30," 0.6% "),e.\u0275\u0275element(31,"i",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(32,"small"),e.\u0275\u0275text(33,"De la p\xe9riode pr\xe9c\xe9dente"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(34,"strong",15),e.\u0275\u0275text(35,"239"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(36,"div",16),e.\u0275\u0275elementStart(37,"div"),e.\u0275\u0275elementStart(38,"div",17),e.\u0275\u0275elementStart(39,"h5",11),e.\u0275\u0275text(40,"Total des visites "),e.\u0275\u0275elementStart(41,"small",8),e.\u0275\u0275text(42,"(par objectif annuel)"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(43,"span",18),e.\u0275\u0275text(44,"78%"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(45,"div",19),e.\u0275\u0275element(46,"div",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(47,"div",7),e.\u0275\u0275elementStart(48,"div",21),e.\u0275\u0275elementStart(49,"p",22),e.\u0275\u0275text(50,"Vistes par communes "),e.\u0275\u0275elementStart(51,"small",8),e.\u0275\u0275text(52,"(ann\xe9e courante)"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(53,"apx-chart",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(54,"div",24),e.\u0275\u0275elementStart(55,"div",25),e.\u0275\u0275element(56,"app-page-title",26),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(57,"div",25),e.\u0275\u0275template(58,le,3,0,"a",27),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(59,"div",1),e.\u0275\u0275elementStart(60,"div",28),e.\u0275\u0275elementStart(61,"div",29),e.\u0275\u0275elementStart(62,"div",30),e.\u0275\u0275elementStart(63,"form",31),e.\u0275\u0275listener("ngSubmit",function(){return i.service.onSearch()}),e.\u0275\u0275elementStart(64,"table",32),e.\u0275\u0275elementStart(65,"thead"),e.\u0275\u0275elementStart(66,"tr"),e.\u0275\u0275elementStart(67,"th",33),e.\u0275\u0275text(68,"Date"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(69,"th",33),e.\u0275\u0275text(70,"D\xe9part"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(71,"th",34),e.\u0275\u0275text(72,"De"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(73,"th",34),e.\u0275\u0275text(74,"\xc0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(75,"th",34),e.\u0275\u0275text(76,"Longueur visit\xe9e"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(77,"th",34),e.\u0275\u0275text(78,"\xc9quipe"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(79,"th",34),e.\u0275\u0275text(80,"Anomalies"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(81,"th",35),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(82,"tbody"),e.\u0275\u0275elementStart(83,"tr",36),e.\u0275\u0275elementStart(84,"td"),e.\u0275\u0275elementStart(85,"div",37),e.\u0275\u0275elementStart(86,"div",38),e.\u0275\u0275elementStart(87,"input",39,40),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275reference(89).open()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(90,"div",38),e.\u0275\u0275elementStart(91,"input",41,42),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275reference(93).open()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(94,"td"),e.\u0275\u0275element(95,"ng-select",43,44),e.\u0275\u0275pipe(97,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(98,"td"),e.\u0275\u0275elementStart(99,"ng-select",45,46),e.\u0275\u0275pipe(101,"async"),e.\u0275\u0275template(102,me,2,2,"ng-template",47),e.\u0275\u0275template(103,ce,2,2,"ng-template",48),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(104,"td"),e.\u0275\u0275elementStart(105,"ng-select",49,50),e.\u0275\u0275pipe(107,"async"),e.\u0275\u0275template(108,ve,2,2,"ng-template",47),e.\u0275\u0275template(109,fe,2,2,"ng-template",48),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(110,"td"),e.\u0275\u0275element(111,"input",51,52),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(113,"td"),e.\u0275\u0275element(114,"ng-select",53,54),e.\u0275\u0275pipe(116,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(117,"td"),e.\u0275\u0275elementStart(118,"td"),e.\u0275\u0275elementStart(119,"button",55),e.\u0275\u0275element(120,"i",56),e.\u0275\u0275text(121,"Rechercher "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(122,"button",57),e.\u0275\u0275listener("click",function(){return i.service.findAll()}),e.\u0275\u0275element(123,"i",58),e.\u0275\u0275text(124,"R\xe9initialiser "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(125,"tr"),e.\u0275\u0275template(126,he,2,0,"td",59),e.\u0275\u0275pipe(127,"async"),e.\u0275\u0275pipe(128,"async"),e.\u0275\u0275template(129,_e,2,0,"td",59),e.\u0275\u0275pipe(130,"async"),e.\u0275\u0275pipe(131,"async"),e.\u0275\u0275pipe(132,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(133,ke,26,21,"tr",60),e.\u0275\u0275pipe(134,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(135,Ve,2,1,"ng-container",61),e.\u0275\u0275pipe(136,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()}2&t&&(e.\u0275\u0275advance(53),e.\u0275\u0275property("series",i.Chartdata.series)("chart",i.Chartdata.chart)("plotOptions",i.Chartdata.plotOptions)("dataLabels",i.Chartdata.dataLabels)("xaxis",i.Chartdata.xaxis)("colors",i.Chartdata.colors)("grid",i.Chartdata.grid),e.\u0275\u0275advance(3),e.\u0275\u0275property("breadcrumbItems",i.breadCrumbItems),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.authService.isAuthorized("visites_add")),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",i.service.visiteForm),e.\u0275\u0275advance(32),e.\u0275\u0275property("items",e.\u0275\u0275pipeBind1(97,36,i.service.departments$))("multiple",!0)("minTermLength",2)("loading",i.service.departmentLoading)("typeahead",i.service.departmentInput$),e.\u0275\u0275advance(4),e.\u0275\u0275property("items",e.\u0275\u0275pipeBind1(101,38,i.service.ANode$))("multiple",!0)("minTermLength",2)("readonly",!i.service.departments)("loading",i.service.ANodeLoading)("typeahead",i.service.ANodeInput$),e.\u0275\u0275advance(6),e.\u0275\u0275property("items",e.\u0275\u0275pipeBind1(107,40,i.service.BNode$))("multiple",!0)("minTermLength",2)("readonly",!i.service.departments)("loading",i.service.BNodeLoading)("typeahead",i.service.BNodeInput$),e.\u0275\u0275advance(9),e.\u0275\u0275property("items",e.\u0275\u0275pipeBind1(116,42,i.service.teams$))("multiple",!0)("minTermLength",2)("loading",i.service.teamLoading)("typeahead",i.service.teamInput$),e.\u0275\u0275advance(12),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(127,44,!e.\u0275\u0275pipeBind1(128,46,i.service.visites$)&&i.service.loading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(130,48,e.\u0275\u0275pipeBind1(131,50,i.service.visites$)&&0===e.\u0275\u0275pipeBind1(132,52,i.service.visites$).length&&i.service.loaded$)),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(134,54,i.service.visites$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(136,56,i.service.pagination$)))},directives:[P.x,$.V,c.NgIf,m._Y,m.JL,m.sg,p.J4,m.Fj,m.JJ,m.u,_.w9,_.bb,_.Z2,c.NgForOf,h.yS,p._h,p.jt,p.iD,p.Vi,p.N9],pipes:[c.AsyncPipe,c.DatePipe],encapsulation:2}),n})();function Oe(n,r){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275elementStart(1,"ngb-alert",39),e.\u0275\u0275listener("closed",function(){const s=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext().removeAlert(s)}),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()}if(2&n){const t=r.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("type",t.type),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.message," ")}}function Me(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"ng-option",40),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=r.$implicit;e.\u0275\u0275property("value","/api/departments/"+t.id),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.titre)}}function je(n,r){1&n&&(e.\u0275\u0275elementStart(0,"div",41,42),e.\u0275\u0275text(2,"Ce champ est obligatoire."),e.\u0275\u0275elementEnd())}function Re(n,r){1&n&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1,"Ce champ est obligatoire."),e.\u0275\u0275elementEnd())}function Qe(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"div",43),e.\u0275\u0275template(1,Re,2,0,"span",44),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.service.ANode.errors.required)}}function Je(n,r){1&n&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1,"Ce champ est obligatoire."),e.\u0275\u0275elementEnd())}function Ue(n,r){if(1&n&&(e.\u0275\u0275elementStart(0,"div",43),e.\u0275\u0275template(1,Je,2,0,"span",44),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.service.BNode.errors.required)}}function Ge(n,r){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",34),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().service.Persist("NEW")}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275text(2,"Cr\xe9er et ajouter un nouveau"),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(1,1,t.service.loading$)||t.service.anomalyLoading)}}function We(n,r){1&n&&e.\u0275\u0275element(0,"i",45)}const Ke=function(){return{year:1900,month:1,day:1}},Ye=function(n){return{"is-invalid":n}},j=n=>({hour:n.getHours(),minute:n.getMinutes(),second:n.getSeconds()}),R=n=>({year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate()});let Q=(()=>{class n{constructor(t,i,a,s){this.fb=t,this.route=i,this.service=a,this.authService=s,this.showError=!1,this.alert=window.alert,this.alerts=[],this.breadCrumbItems=[{label:"Visites"},{label:"Fiche visite",active:!0}],a.loadDepartments(!1),a.loadANodes(),a.loadBNodes(),a.loadTeams(),a.visiteForm=this.fb.group({anomalies:this.fb.array([]),date:[""],time:[""],team:[""],nbSupport:[null],department:["",m.kI.required],nodeA:["",m.kI.required],nodeB:[[]]});let d=this.route.snapshot.paramMap.get("id");if(d)this.service.EditeMode=!0,a.getByKey(Number(d)).subscribe(l=>{this.service.existingVisit=l,this.id=String(l.id),a.loadTeams(l.team?[l.team]:[]),a.loadANodes(l.node_a?[l.node_a]:[]),a.loadBNodes(l.node_b?l.node_b:[]);let f=null,v=null;l.date&&(v=(n=>new Date(Date.parse(n)))(l.date),f=j(v)),a.visiteForm.patchValue({date:R(v),time:f,team:l.team?l.team["@id"]:null,department:l.node_a.department?l.node_a.department["@id"]:null,nodeA:l.node_a?l.node_a["@id"]:null,nbSupport:l.nbSupport?l.nbSupport:0,nodeB:l.node_b.length?l.node_b.map(S=>S["@id"]):[]}),this.currentEdge={ANode:this.service.ANode.value,BNode:this.service.BNode.value,department:l.node_a.department["@id"],type:!0},this.formListeners()});else{let l=new Date,f=j(l),v=R(l);a.visiteForm.patchValue({date:v,time:f}),this.formListeners()}}AlertANodeChange(){this.addAlert("En changeant le PS, les champs tron\xe7ons d'anomalies seront r\xe9initialis\xe9s.","warning")}AlertDeparChange(){let t=this.service.ANode.value,i=this.service.BNode.value,a=t&&""!==t.trim()||i&&0!==i.length,s=this.hasNonEmptyEdges;(a||a)&&this.addAlert(`En changeant le d\xe9partement, les champs ${a?"appareils de coupeur":""}${a&&s?" et ":""}${s?"tron\xe7ons d'anomalies":""} seront r\xe9initialis\xe9s.`,"warning")}removeAlert(t){const i=this.alerts.indexOf(t);-1!==i&&this.alerts.splice(i,1)}addAlert(t,i){if(-1===this.alerts.findIndex(s=>s.message===t&&s.type===i)){window.scrollTo(0,0);const s={message:t,type:i};this.alerts.push(s),setTimeout(()=>this.removeAlert(s),15e3)}}formListeners(){let t=this.service.ANode,i=this.service.BNode,a=this.service.department;t.valueChanges.subscribe(()=>{this.anomalies.controls.forEach(s=>{s.get("edge").reset()}),this.currentEdge={ANode:t.value,BNode:i.value,department:a.value,type:!0}}),i.valueChanges.subscribe(()=>{t.value&&""!==t.value.trim()&&(this.currentEdge={ANode:t.value,BNode:i.value,department:a.value,type:!0})}),a.valueChanges.subscribe(()=>{t.reset(),i.reset(),this.anomalies.controls.forEach(s=>{s.get("edge").reset()})})}get anomalies(){return this.service.visiteForm.get("anomalies")}get hasNonEmptyEdges(){return this.anomalies.controls.some(t=>{const i=t.get("edge");return i&&""!==i.value.trim()})}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275directiveInject(m.qu),e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(A),e.\u0275\u0275directiveInject(N.$))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["app-visite-persist"]],decls:67,vars:58,consts:[[1,"container-fluid","pb-5","mb-5",3,"formGroup"],["title","Formulaire de visite",3,"Loading","breadcrumbItems"],[4,"ngFor","ngForOf"],[1,"row","mt-4"],[1,"col-12"],[1,"card"],[1,"card-body"],[1,"mb-3","row"],["for","name-input",1,"col-md-2","col-form-label"],[1,"col-md-10","row"],[1,"col"],[1,"input-group","clockpicker"],["ngbDatepicker","","formControlName","date",1,"form-control",3,"minDate","click"],["ds","ngbDatepicker"],[1,"col-auto"],["seconds","true","formControlName","time",3,"spinners"],["for","input-2",1,"col-md-2","col-form-label"],["id","input-2",1,"col-md-10"],["formControlName","department","placeholder","D\xe9par..",3,"open"],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback d-block d-block",4,"ngIf"],["for","input-1",1,"col-md-2","col-form-label"],["id","input-1",1,"col-md-10",3,"click"],["formControlName","nodeA","bindLabel","titre","bindValue","@id","typeToSearchText","Veuillez saisir 2 caract\xe8res ou plus",3,"items","minTermLength","readonly","loading","ngClass","typeahead"],["class","invalid-feedback d-block",4,"ngIf"],[1,"col-md-10"],["formControlName","nodeB","bindLabel","titre","bindValue","@id","typeToSearchText","Veuillez saisir 2 caract\xe8res ou plus",3,"items","minTermLength","multiple","readonly","loading","typeahead"],["formControlName","team","bindLabel","titre","bindValue","@id","typeToSearchText","Veuillez saisir 2 caract\xe8res ou plus",3,"items","minTermLength","loading","typeahead"],["for","nbSupport-input",1,"col-md-2","col-form-label"],["formControlName","nbSupport","type","number","step","1","id","nbSupport-input",1,"form-control"],[3,"anomalies","currentEdge","parentFormGroup","showErrors","addAlert"],[1,"sticky-actions"],[1,"btn","btn-primary","float-end",3,"disabled","click"],["class","btn btn-light me-2 float-end text-primary",3,"disabled","click",4,"ngIf"],[1,"btn","btn-light","me-2","float-end","text-primary",3,"disabled","click"],[1,"fas","fa-arrow-circle-left","me-1"],["type","button",1,"btn","text-danger","float-end","me-2","fw-medium","btn-light",3,"disabled","click"],[1,"mdi","mdi-trash-can","align-middle","me-2"],["class","bx bx-loader-alt fa-spin float-end me-3",4,"ngIf"],[1,"custom-alert","glow","mt-3",3,"type","closed"],[3,"value"],[1,"invalid-feedback","d-block","d-block"],["postfeedback",""],[1,"invalid-feedback","d-block"],[4,"ngIf"],[1,"bx","bx-loader-alt","fa-spin","float-end","me-3"]],template:function(t,i){if(1&t){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275element(1,"app-page-title",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,Oe,3,2,"div",2),e.\u0275\u0275elementStart(4,"div",3),e.\u0275\u0275elementStart(5,"div",4),e.\u0275\u0275elementStart(6,"div",5),e.\u0275\u0275elementStart(7,"div",6),e.\u0275\u0275elementStart(8,"div",7),e.\u0275\u0275elementStart(9,"label",8),e.\u0275\u0275text(10,"Date"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",9),e.\u0275\u0275elementStart(12,"div",10),e.\u0275\u0275elementStart(13,"div",11),e.\u0275\u0275elementStart(14,"input",12,13),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275reference(15).open()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",14),e.\u0275\u0275element(17,"ngb-timepicker",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"div",7),e.\u0275\u0275elementStart(19,"label",16),e.\u0275\u0275text(20,"D\xe9part"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"div",17),e.\u0275\u0275elementStart(22,"ng-select",18),e.\u0275\u0275listener("open",function(){return i.service.department.value&&i.AlertDeparChange()}),e.\u0275\u0275template(23,Me,2,2,"ng-option",19),e.\u0275\u0275pipe(24,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(25,je,3,0,"div",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"div",7),e.\u0275\u0275elementStart(27,"label",21),e.\u0275\u0275text(28,"De"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"div",22),e.\u0275\u0275listener("click",function(){return i.showError=!0}),e.\u0275\u0275element(30,"ng-select",23),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275template(32,Qe,2,1,"div",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"div",7),e.\u0275\u0275elementStart(34,"label",21),e.\u0275\u0275text(35,"\xc0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(36,"div",25),e.\u0275\u0275element(37,"ng-select",26),e.\u0275\u0275pipe(38,"async"),e.\u0275\u0275template(39,Ue,2,1,"div",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(40,"div",7),e.\u0275\u0275elementStart(41,"label",8),e.\u0275\u0275text(42,"\xc9quipe"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(43,"div",25),e.\u0275\u0275element(44,"ng-select",27),e.\u0275\u0275pipe(45,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(46,"div",7),e.\u0275\u0275elementStart(47,"label",28),e.\u0275\u0275text(48,"Longueur visit\xe9e"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(49,"div",25),e.\u0275\u0275element(50,"input",29),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(51,"app-related-anomalies",30),e.\u0275\u0275listener("addAlert",function(d){return i.addAlert(d.message,d.type)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(52,"div",31),e.\u0275\u0275elementStart(53,"button",32),e.\u0275\u0275listener("click",function(){return i.service.Persist("EDIT")}),e.\u0275\u0275pipe(54,"async"),e.\u0275\u0275text(55," Sauvegarder"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(56,Ge,3,3,"button",33),e.\u0275\u0275elementStart(57,"button",34),e.\u0275\u0275listener("click",function(){return i.service.Persist("LIST")}),e.\u0275\u0275pipe(58,"async"),e.\u0275\u0275element(59,"i",35),e.\u0275\u0275text(60," Sauvegarder et retourner \xe0 la liste"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(61,"button",36),e.\u0275\u0275listener("click",function(){return i.service.deleteItem()}),e.\u0275\u0275pipe(62,"async"),e.\u0275\u0275element(63,"i",37),e.\u0275\u0275text(64,"Supprimer "),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(65,We,1,0,"i",38),e.\u0275\u0275pipe(66,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()}2&t&&(e.\u0275\u0275property("formGroup",i.service.visiteForm),e.\u0275\u0275advance(1),e.\u0275\u0275property("Loading",e.\u0275\u0275pipeBind1(2,37,i.service.loading$))("breadcrumbItems",i.breadCrumbItems),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",i.alerts),e.\u0275\u0275advance(11),e.\u0275\u0275property("minDate",e.\u0275\u0275pureFunction0(55,Ke)),e.\u0275\u0275advance(3),e.\u0275\u0275property("spinners",!1),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(24,39,i.service.departments$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.showError&&!i.service.department.value),e.\u0275\u0275advance(5),e.\u0275\u0275property("items",e.\u0275\u0275pipeBind1(31,41,i.service.ANode$))("minTermLength",2)("readonly",!i.service.department.value)("loading",i.service.ANodeLoading)("ngClass",e.\u0275\u0275pureFunction1(56,Ye,i.service.ANode.invalid&&i.service.submitted))("typeahead",i.service.ANodeInput$),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.service.submitted&&i.service.ANode.errors),e.\u0275\u0275advance(5),e.\u0275\u0275property("items",e.\u0275\u0275pipeBind1(38,43,i.service.BNode$))("minTermLength",2)("multiple",!0)("readonly",!i.service.department.value)("loading",i.service.BNodeLoading)("typeahead",i.service.BNodeInput$),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.service.submitted&&i.service.BNode.errors),e.\u0275\u0275advance(5),e.\u0275\u0275property("items",e.\u0275\u0275pipeBind1(45,45,i.service.teams$))("minTermLength",2)("loading",i.service.teamLoading)("typeahead",i.service.teamInput$),e.\u0275\u0275advance(7),e.\u0275\u0275property("anomalies",i.anomalies)("currentEdge",i.currentEdge)("parentFormGroup",i.service.visiteForm)("showErrors",i.service.submitted),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(54,47,i.service.loading$)||i.service.anomalyLoading),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!i.service.EditeMode),e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(58,49,i.service.loading$)||i.service.anomalyLoading),e.\u0275\u0275advance(4),e.\u0275\u0275classProp("d-none",!i.service.EditeMode||!i.service.existingVisit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(62,51,i.service.loading$)||i.service.anomalyLoading),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",i.service.submitted&&(e.\u0275\u0275pipeBind1(66,53,i.service.loading$)||i.service.anomalyLoading)))},directives:[m._Y,m.JL,m.sg,$.V,c.NgForOf,p.J4,m.Fj,m.JJ,m.u,p.Pm,_.w9,c.NgIf,c.NgClass,m.wV,z.T,p.xm,_.xv],pipes:[c.AsyncPipe],encapsulation:2}),n})();const He=[{path:"",component:Pe,canActivate:[E.p],data:{access:"visites_show"}},{path:"details/:id",component:oe,canActivate:[E.p],data:{access:"visites_details"}},{path:"persist/:id",component:Q,canActivate:[E.p],data:{access:"visites_update"}},{path:"persist",component:Q,canActivate:[E.p],data:{access:"visites_add"}}];let Xe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=e.\u0275\u0275defineInjector({imports:[[h.Bz.forChild(He)],h.Bz]}),n})();var qe=o(9922),et=o(6831);let tt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=e.\u0275\u0275defineInjector({imports:[[Xe,qe.m,p.M,p.UL,p.dT,p._A,P.X,et.U]]}),n})()}}]);