"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[798],{5630:(R,T,r)=>{r.d(T,{ob:()=>b,Su:()=>L});var s=r(3668),f=r(9133),c=r(6019);function M(l,C){if(1&l&&(s.\u0275\u0275elementStart(0,"label",2),s.\u0275\u0275elementStart(1,"span",3),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(3,"span",4),s.\u0275\u0275text(4),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementEnd()),2&l){const e=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275styleProp("color",e.getColor("checkedTextColor")),s.\u0275\u0275attribute("aria-label",e.checkedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate(e.checkedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275styleProp("color",e.getColor("uncheckedTextColor")),s.\u0275\u0275attribute("aria-label",e.uncheckedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate(e.uncheckedLabel)}}const U=["*"],E=new s.InjectionToken("UI_SWITCH_OPTIONS"),y={provide:f.JU,useExisting:(0,s.forwardRef)(()=>b),multi:!0};let b=(()=>{class l{constructor(e={},a){this.cdr=a,this.change=new s.EventEmitter,this.changeEvent=new s.EventEmitter,this.valueChange=new s.EventEmitter,this.onTouchedCallback=S=>{},this.onChangeCallback=S=>{},this.size=e&&e.size||"medium",this.color=e&&e.color,this.switchOffColor=e&&e.switchOffColor,this.switchColor=e&&e.switchColor,this.defaultBgColor=e&&e.defaultBgColor,this.defaultBoColor=e&&e.defaultBoColor,this.checkedLabel=e&&e.checkedLabel,this.uncheckedLabel=e&&e.uncheckedLabel,this.checkedTextColor=e&&e.checkedTextColor,this.uncheckedTextColor=e&&e.uncheckedTextColor}set checked(e){this._checked=!1!==e}get checked(){return this._checked}set disabled(e){this._disabled=!1!==e}get disabled(){return this._disabled}set reverse(e){this._reverse=!1!==e}get reverse(){return this._reverse}set loading(e){this._loading=!1!==e}get loading(){return this._loading}getColor(e=""){return"borderColor"===e?this.defaultBoColor:"switchColor"===e?this.reverse?this.checked&&this.switchOffColor||this.switchColor:this.checked?this.switchColor:this.switchOffColor||this.switchColor:"checkedTextColor"===e?this.reverse?this.uncheckedTextColor:this.checkedTextColor:"uncheckedTextColor"===e?this.reverse?this.checkedTextColor:this.uncheckedTextColor:this.reverse?this.checked?this.defaultBgColor:this.color:this.checked?this.color:this.defaultBgColor}onClick(e){this.disabled||(this.checked=!this.checked,this.change.emit(this.checked),this.valueChange.emit(this.checked),this.changeEvent.emit(e),this.onChangeCallback(this.checked),this.onTouchedCallback(this.checked),this.cdr.markForCheck())}onToggle(e){this.disabled||(this.beforeChange?this._beforeChange=this.beforeChange.subscribe(a=>{a&&this.onClick(e)}):this.onClick(e))}writeValue(e){e!==this.checked&&(this.checked=!!e),this.onChangeCallback(this.checked),this.cdr&&this.cdr.markForCheck()}registerOnChange(e){this.onChangeCallback=e}registerOnTouched(e){this.onTouchedCallback=e}setDisabledState(e){this.disabled=e}ngOnDestroy(){this._beforeChange&&this._beforeChange.unsubscribe()}}return l.\u0275fac=function(e){return new(e||l)(s.\u0275\u0275directiveInject(E,8),s.\u0275\u0275directiveInject(s.ChangeDetectorRef))},l.\u0275cmp=s.\u0275\u0275defineComponent({type:l,selectors:[["ui-switch"]],hostBindings:function(e,a){1&e&&s.\u0275\u0275listener("click",function(B){return a.onToggle(B)})},inputs:{size:"size",color:"color",switchOffColor:"switchOffColor",switchColor:"switchColor",defaultBgColor:"defaultBgColor",defaultBoColor:"defaultBoColor",checkedLabel:"checkedLabel",uncheckedLabel:"uncheckedLabel",checkedTextColor:"checkedTextColor",uncheckedTextColor:"uncheckedTextColor",checked:"checked",disabled:"disabled",reverse:"reverse",loading:"loading",beforeChange:"beforeChange"},outputs:{change:"change",changeEvent:"changeEvent",valueChange:"valueChange"},features:[s.\u0275\u0275ProvidersFeature([y])],ngContentSelectors:U,decls:4,vars:20,consts:[["type","button","role","switch",1,"switch"],["class","switch-pane",4,"ngIf"],[1,"switch-pane"],[1,"switch-label-checked"],[1,"switch-label-unchecked"]],template:function(e,a){1&e&&(s.\u0275\u0275projectionDef(),s.\u0275\u0275elementStart(0,"button",0),s.\u0275\u0275template(1,M,5,8,"label",1),s.\u0275\u0275elementStart(2,"small"),s.\u0275\u0275projection(3),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementEnd()),2&e&&(s.\u0275\u0275styleProp("background-color",a.getColor())("border-color",a.getColor("borderColor")),s.\u0275\u0275classProp("checked",a.checked)("disabled",a.disabled)("loading",a.loading)("switch-large","large"===a.size)("switch-medium","medium"===a.size)("switch-small","small"===a.size),s.\u0275\u0275attribute("aria-checked",a.checked),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",a.checkedLabel||a.uncheckedLabel),s.\u0275\u0275advance(1),s.\u0275\u0275styleProp("background",a.getColor("switchColor")))},directives:[c.NgIf],encapsulation:2}),l})(),L=(()=>{class l{static forRoot(e){return{ngModule:l,providers:[{provide:E,useValue:e||{}}]}}}return l.\u0275fac=function(e){return new(e||l)},l.\u0275mod=s.\u0275\u0275defineNgModule({type:l}),l.\u0275inj=s.\u0275\u0275defineInjector({imports:[[c.CommonModule,f.u5],f.u5]}),l})()},5826:(R,T,r)=>{r.d(T,{l:()=>s,o:()=>f});var s=(()=>{return(c=s||(s={}))[c["D\xe9fauts mat\xe9riels"]=0]="D\xe9fauts mat\xe9riels",c[c["Tiers/corps \xe9tranger"]=1]="Tiers/corps \xe9tranger",c[c.Intemp\u00e9ries=2]="Intemp\xe9ries",c[c["Cause inconnue"]=3]="Cause inconnue",s;var c})();const f=[{label:"Urgent < mois",value:"ELEVE",color:"danger"},{label:"Court terme < 1an",value:"FAIBLE",color:"warning"},{label:"Faible terme > 1an",value:"NORMAL",color:"success"},{label:"Autre",value:"OTHER",color:"info"}]},4038:(R,T,r)=>{r.d(T,{M:()=>P});var s=r(4762),f=r(1824),c=r(3405),M=r(4099),U=r(3596),E=r(2411),y=r(5686),b=r(5389),L=r(8735),l=r(1366),C=r(9204),e=r(2047),a=r(8053),S=r(5826),B=r(8260),v=r(3668),A=r(5633),W=r(6761),I=r(7777),j=r(4885),n=r(5565),d=r(4522),_=r(8274);const u=m=>""!==m?m.year+"-"+m.month+"-"+("0"+m.day).slice(-2):"";let P=(()=>{class m extends f.c8{constructor(t,o,i,h,D,p,g,K){super("anomalies",t),this.serviceElementsFactory=t,this.confirmDialogService=o,this.departmentService=i,this.communeService=h,this.edgeService=D,this.userService=p,this.http=g,this.toast=K,this.pageSize=B.N.pageSize,this.server=B.N.serverURL,this.severityOptions=S.o,this.departmentLoading=!1,this.departmentInput$=new c.xQ,this.usersLoading=!1,this.usersInput$=new c.xQ,this.edgesInRange$=new M.X([]),this.edgesLoading=!1,this.edgesInput$=new c.xQ,this.submitted=!1,this.statusLoading=0,this.page=1}findAll(){this.findByCriteria({page:1})}loadDepartments(t=!0){this.departments$=t?(0,U.z)((0,E.of)([]),this.departmentInput$.pipe((0,y.b)(500),(0,b.x)(),(0,L.h)(o=>null!=o),(0,l.b)(()=>this.departmentLoading=!0),(0,C.w)(o=>this.departmentService.getWithQuery("properties[]=id&properties[]=titre&titre="+o).pipe((0,e.K)(()=>(0,E.of)([])),(0,l.b)(()=>this.departmentLoading=!1))))):this.departmentService.getWithQuery("properties[]=id&properties[]=titre")}loadUsers(t=[]){this.users$=(0,U.z)((0,E.of)(t),this.usersInput$.pipe((0,y.b)(500),(0,b.x)(),(0,L.h)(o=>null!=o),(0,l.b)(()=>this.usersLoading=!0),(0,C.w)(o=>this.userService.getWithQuery("properties[]=id&properties[]=fullName&fullName="+o).pipe((0,e.K)(()=>(0,E.of)([])),(0,l.b)(()=>this.usersLoading=!1)))))}loadEdgesInRange(t,o){let i=Object.assign({},t);i["id[]"]=o,i["properties[]"]="id",i["properties[node_a][]"]="titre",i["properties[node_b][]"]="titre",i.pagination="false",delete i.node_a,delete i.page,i.node_b&&delete i.node_b,this.edgeService.getWithQuery(i).subscribe(h=>{this.edgesInRange$.next(h)})}loadEdgesByDepar(t){this.edge.reset(),this.edgesInRange$.next([]),this.edgeService.getWithQuery("properties[]=id&properties[]=node_a&properties[]=node_b&itemsPerPage=1000&department.id="+t.match(/\d+/)[0]).subscribe(o=>{this.edgesInRange$.next(o)})}getPagination(){this.pagination$=(0,E.of)(),this.pagination$=this.selectors$.entityActions$.pipe((0,a.U)(t=>t.payload.pagination))}deleteItem(t,o){this.confirmDialogService.setConfirmation("Vous \xeates s\xfbr de vouloir supprimer?",()=>{this.delete(t).pipe(this.toast.observe({loading:"Suppression...",success:()=>(o.closest("tr").remove(),"Anomaly supprim\xe9 avec succ\xe8s"),error:"un probl\xe8me est survenu, veuillez r\xe9essayer"})).subscribe()})}onSearch(){this.page=1,this.lastSearchedParams=this.anomalyForm.value,this.findByCriteria(Object.assign({page:1},this.lastSearchedParams))}onCreate(){let t=this.anomalyForm;if(this.submitted=!0,t.invalid)return;this.submitted=!1;let o=this.toast,i=Object.entries(t.value);const h=Object.fromEntries(i.filter(([D,p])=>""!==p));this.add(h).subscribe({error:()=>o.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){t.reset(),o.success("Anomaly ajout\xe9 avec succ\xe8s")}})}onUpdate(t){let o=this.anomalyForm;if(this.submitted=!0,o.invalid)return;this.submitted=!1;let i=this.toast,h=Object.entries(o.value);const D=Object.fromEntries(h.filter(([p,g])=>""!==g));D.id=t,this.update(D).subscribe({error:()=>i.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){i.success("Anomaly a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}updateStatus(t,o){t.stopPropagation();let i=this,D={id:o,status:!t.target.classList.contains("checked")};this.statusLoading=o,this.update(D).subscribe({error:()=>i.toast.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){i.statusLoading=0,i.toast.success("Statut a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}bulkCreate(t){return this.http.post(`${this.server}/api/anomalies/bulk?action=create`,{anomalies:t})}getRelatedAnomalies(t,o,i){t&&""!==t.trim()&&this.findByCriteria(Object.assign(Object.assign({page:1,"status[]":[!1,null]},{node_a:t.match(/\d+/)[0],depar:i.match(/\d+/)[0]}),o&&0!==o.length&&{node_b:o.map(h=>h.match(/\d+/)[0])}),!0)}findByCriteria(t,o=!1){var i,h;return(0,s.mG)(this,void 0,void 0,function*(){if(this.anomalies$=(0,E.of)([]),Object.keys(t).length>1){const p=g=>t[g]&&delete Object.assign(t,{["createdAt["+g+"]"]:u(t[g])})[g];if(p("before"),p("after"),t.node_a){let g=yield this.edgeService.getEdgesInRange(t.depar,t.node_a,t.node_b?t.node_b:null).toPromise();this.loadEdgesInRange(t,g),t["edge.id[]"]=g,delete t.node_a,t.node_b&&delete t.node_b}}o&&(null===(h=!(null===(i=t["edge.id[]"])||void 0===i?void 0:i.length))||void 0===h||h)&&(t["edge.id[]"]=1e9);let D=Object.keys(t).filter(p=>""!=t[p]&&null!=t[p]).reduce((p,g)=>Object.assign(Object.assign({},p),{[g]:t[g]}),{});this.anomalies$=this.getWithQuery(D),this.getPagination()})}onPaginate(t){this.findByCriteria(Object.assign({page:t},this.lastSearchedParams))}getSeverity(t,o){const i=this.severityOptions.find(h=>h.value===t);return i?o?i.color:i.label:""}get department(){return this.anomalyForm.get("department")}get title(){return this.anomalyForm.get("title")}get edge(){return this.anomalyForm.get("edge")}}return m.\u0275fac=function(t){return new(t||m)(v.\u0275\u0275inject(f.yV),v.\u0275\u0275inject(A.D),v.\u0275\u0275inject(W.l),v.\u0275\u0275inject(I.s),v.\u0275\u0275inject(j.p),v.\u0275\u0275inject(n.K),v.\u0275\u0275inject(d.eN),v.\u0275\u0275inject(_.jE))},m.\u0275prov=v.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},5565:(R,T,r)=>{r.d(T,{K:()=>W});var s=r(1824),f=r(3405),c=r(3596),M=r(2411),U=r(5686),E=r(5389),y=r(8735),b=r(1366),L=r(9204),l=r(8053),C=r(2047),e=r(8260),a=r(3668),S=r(5633),B=r(4522),v=r(7686),A=r(8274);let W=(()=>{class I extends s.c8{constructor(n,d,_,u,P){super("users",n),this.serviceElementsFactory=n,this.confirmDialogService=d,this.http=_,this.authService=u,this.toast=P,this.pageSize=e.N.pageSize,this.server=e.N.serverURL,this.teamLoading=!1,this.teamInput$=new f.xQ,this.submitted=!1,this.loading=!1,this.page=1}findAll(){this.findByCriteria({page:1})}loadTeams(n=[]){this.teams$=(0,c.z)((0,M.of)(n),this.teamInput$.pipe((0,U.b)(500),(0,E.x)(),(0,y.h)(d=>null!=d),(0,b.b)(()=>this.teamLoading=!0),(0,L.w)(d=>this.http.get(`${this.server}/api/teams?properties[]=id&properties[]=titre&titre=`+d).pipe((0,l.U)(_=>_["hydra:member"]),(0,C.K)(()=>(0,M.of)([])),(0,b.b)(()=>this.teamLoading=!1)))))}getPagination(){this.pagination$=(0,M.of)(),this.pagination$=this.selectors$.entityActions$.pipe((0,l.U)(n=>n.payload.pagination))}deleteItem(n,d){this.confirmDialogService.setConfirmation("Vous \xeates s\xfbr de vouloir supprimer?",()=>{this.delete(n).pipe(this.toast.observe({loading:"Suppression...",success:()=>(d.closest("tr").remove(),"Utilisateur supprim\xe9 avec succ\xe8s"),error:"un probl\xe8me est survenu, veuillez r\xe9essayer"})).subscribe()})}onSearch(){this.page=1,this.lastSearchedParams=this.userForm.value,this.findByCriteria(Object.assign({page:1},this.lastSearchedParams))}onCreate(){let n=this.userForm;if(this.submitted=!0,n.invalid)return;this.submitted=!1;let d=this.toast,_=Object.entries(n.value);const u=Object.fromEntries(_.filter(([P,m])=>""!==m));u.roles=[u.roles.toString()],this.add(u).subscribe({error:()=>d.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){n.reset(),d.success("Utilisateur ajout\xe9 avec succ\xe8s")}})}onUpdate(n,d=!1){let _=this.userForm;if(this.submitted=!0,_.invalid)return;this.submitted=!1;let u=this,P=this.toast,m=this.authService.user,O=Object.assign({},_.value);O.id=n,d?O=Object.entries(O).reduce((t,[o,i])=>(""!==i&&null!==i&&(t[o]=i),t),{}):O.roles=[O.roles.toString()],this.update(O).subscribe({error:()=>P.error("un probl\xe8me est survenu, veuillez r\xe9essayer"),complete(){m.id==n?(u.loading=!0,u.authService.logout(!1),u.authService.login(O.username,O.password).subscribe({error:t=>{t&&P.error(t.error.message),u.loading=!1},complete(){u.loading=!1,P.success("L'utilisateur a \xe9t\xe9 mis \xe0 jour avec succ\xe8s"),setTimeout(()=>window.location.reload(),10)}})):P.success("L'utilisateur a \xe9t\xe9 mis \xe0 jour avec succ\xe8s")}})}get fullName(){return this.userForm.get("fullName")}get username(){return this.userForm.get("username")}get password(){return this.userForm.get("password")}get roles(){return this.userForm.get("roles")}get team(){return this.userForm.get("team")}findByCriteria(n){this.users$=(0,M.of)([]);let d=Object.keys(n).filter(_=>""!=n[_]&&null!=n[_]).reduce((_,u)=>Object.assign(Object.assign({},_),{[u]:n[u]}),{});this.users$=this.getWithQuery(d),this.getPagination()}onPaginate(n){this.findByCriteria(Object.assign({page:n},this.lastSearchedParams))}}return I.\u0275fac=function(n){return new(n||I)(a.\u0275\u0275inject(s.yV),a.\u0275\u0275inject(S.D),a.\u0275\u0275inject(B.eN),a.\u0275\u0275inject(v.$),a.\u0275\u0275inject(A.jE))},I.\u0275prov=a.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac,providedIn:"root"}),I})()}}]);